<!DOCTYPE html>
<html lang="en">
   <head>
      {% include 'scripts.html' %}
   </head>
   <body>
      {% include 'stheading.html' %}  
      <main>
         <div class="row center-align">
            <div class="col s12">
               <h3>Your Course Shop</h3>
            </div>
         </div>
         <div class="row">
            <div class="col s12 m8 offset-m2">
               <div class="card">
                  <div class="card-content">
                     <form id="store" name="store" action="#" onsubmit="return updatePrices()" method="post">
                        {% csrf_token %}					
                        <table class="responsive-table">
                           <thead>
                              <tr>
                                 <th>Name</th>
                                 <th>Description</th>
                                 <th>Price</th>
                                 <th>Quantity</th>
                                 <th>Cost</th>
                                 <th>For Assignment</th>
                                 <th></th>
                              </tr>
                           </thead>
                           <tbody>
                              {% for buyOpt in buyOptions %}
                              <tr>
                                 <td>{{buyOpt.displayName}}</td>
                                 <td>{{buyOpt.description}}</td>
                                 <td>{{buyOpt.cost}}</td>
                                 <td><input name="buyOptionQuantity{{buyOpt.id}}" id="buyOptionQuantity{{buyOpt.id}}" type="number" min="0" max="999" value="0" {% if buyOpt.challenges == None %}readonly{% endif %}></td>
                                 <td><div id="priceFor{{buyOpt.id}}">0</div></td>
                                 <td>
                                    {% if buyOpt.challenges != None and buyOpt.challenges != 0 %}
                                    <select name="challengeFor{{buyOpt.name}}">
                                    {% for id, name in buyOpt.challenges %}
                                        <option value="{{id}}">{{name}}</option>
                                    {% endfor %}
                                    </select>
                                    {% endif %}
                                </td>
                                 <td></td>
                              </tr>
                              {% empty %}
                              <tr>
                                 <td class="center-align" colspan="6">No Items in Shop</td>
                              </tr>
                              {% endfor %}
                        </table>
                        <table>
                           <thead>
                              <tr>
                                 <th>Your current balance: {{studentVirtualCurrency}}</th>
                                 <th class="secondary-content"><span id="total" class="black-text">Total: 0</span></th>
                              </tr>
                           </thead>
                           <tbody>
                              <tr>
                                 <td></td>
                                 <td class="secondary-content"><button class="btn waves-effect waves-light" type="submit" name="buy" value="Buy">Buy
                                    <i class="material-icons left">attach_money</i>
                                    </button>
                                 </td>
                              </tr>
                           </tbody>
                        </table>
                     </form>
                  </div>
                  <div class="card-action right-align">
                    <div class="row right-align">
                        <div class="col s12">
                            <a class="waves-effect waves-light btn" href="/oneUp/students/StudentCourseHome"><i class="material-icons left">navigate_before</i>Back</a>
                        </div>
                    </div>
                  </div>
               </div>
            </div>
         </div>
      </main>
      {% include 'footer.html' %}
      <script>
         var prices=[{% for buyOpt in buyOptions2 %}{{buyOpt.cost}},{%endfor%}]
         function updatePrices() {
         	var len = prices.length;
         	var total = 0;
         	for (var i = 0; i<len; i++) {
         		if (document.getElementById("buyOptionQuantity"+i).value.length > 3){
         			document.getElementById("buyOptionQuantity"+i).value = document.getElementById("buyOptionQuantity"+i).value.slice(0, 3);
         		}
         		var quantity = document.getElementById("buyOptionQuantity"+i).value;
         		var price = quantity*prices[i];
         		total += price;
         		document.getElementById("priceFor"+i).innerHTML = price;
         	
         		
         	}
         	document.getElementById("total").innerHTML = "Total: " + total;
         	checkTotal();
         }
         function checkTotal(){
         	var total = document.getElementById("total").innerHTML;
         	if ( {{studentVirtualCurrency}} - parseInt(total) < 0 ) {
              alert("You do not have enough money ");
              return false;
           }
         }
         for (var i = 0; i<{{numBuyOptions}}; i++) {
         	document.getElementById("buyOptionQuantity"+i).addEventListener('change',updatePrices);
         }
      </script>
   </body>
</html>