<!-- modeled after ChallengeQuestions.html
by James Cherry -->

<!DOCTYPE html>
<html lang="en">
   <head>
      {% include 'scripts.html' %}
      <script>
         $(document).ready(function(){
             $('#create').on('click', function(){
                 var val = $('#create-type').find(':selected').val();
                 if (val){
                     top.location.href = val;
                 }
             });
         
             $('.chips').material_chip();
             $('.chips-tags').material_chip({
                 placeholder: 'Enter a tag'
             });
         });
      </script>
      <script> /* 2/18/2019 */
	      var hidden = document.querySelectorAll('.hidden');
			var select = document.querySelector('#create-type');
			
			select.addEventListener('change', function() {
				for (var i in Object.keys(hidden)) {
					hidden[i].classList.add('hidden');
				}
				
				document.querySelector('#' + this.value).classList.remove('hidden');
			});
      </script>
	  <style>
	  		.hidden { display: none; }
	  </style>
   </head>
   <body>
      {% include 'heading.html' %}
      <main>
         <div class="row center-align">
            <div class="col s12 m10 offset-m1">
               {% if unassign %}  
               <h3>Goals for {{studentID}}</h3>
            </div>
         </div>
         <form name="goal" action="/oneUp/students/goalCreate" method="POST">
            {% csrf_token %}
            <input type="hidden" name="studentGoalID" value="{{studentGoalID}}">
            <input type="hidden" name="studentID" value="{{studentID}}">
         <div class="row right-align">
            <div class="col s12 m10 offset-m1">
               <a class="modal-trigger waves-effect waves-light btn" href="#goal-create"><i class="material-icons left">add_circle</i>Create New Goal</a>  
               <div id="goal-create" class="modal modal-fixed-footer">
                  <div class="modal-content">
                     <div class="row center-align">
                        <div class="col s12 m10 offset-m1">
                           <h4>Create a New Goal</h4>
                        </div>
                     </div>
                     <div class="row">
                        <div class="input-field col s12 m10 offset-m1">
                           <select id="create-type">
                              <option value="" disabled selected>Select a Goal Type</option>
                              <option value="warmUps" onclick="showFields(warmUps)">Warm Ups</option>
                              <option value="streak">Streak</option>
                              <option value="courseBucks">Course Bucks</option>
                              <option value="courseXP">Course XP</option>
                              <option value="courseBadges">Course Badges</option>
                           </select>                           
                           <label>Goal Type</label>
                        </div>
                        
                        <!-- 2/18/2019  -->
                        <div id="warmUps" class="hidden">
                        	<input type="number" value="{{targetedNumber}}">
                        	<input type="score" value="{{targetedScore}}">
                        </div>
                        <div id="streak" class="hidden">
                        	<input type="number" value="{{targetedNumber}}">
                        	<input type="score" value="{{targetedScore}}">
                        </div>
                        <div id="courseBucks" class="hidden">
                        	<input type="number" value="{{targetedNumber}}">
                        </div>
                        <div id="courseXP" class="hidden">
                        	<input type="number" value="{{targetedNumber}}">
                        </div>
                        <div id="courseBadges" class="hidden">
                        	<input type="number" value="{{targetedNumber}}">
                        </div>
                        
                     </div>
                  </div>
                  <div class="modal-footer">
                     <a href="#!" class="modal-action modal-close waves-effect waves-light btn-flat" style="color: #00bcd4">Cancel</a>
                     <a href="#!" class="modal-action modal-close waves-effect waves-light btn" id="create">Create Goal</a>
                  </div>
                  
               </div>
         </div>
         
         <div class="row">
            <div class="col s12 m10 offset-m1">
               <div class="card">
                  <div class="card-content">
                     <table>
                        <thead>
                           <tr>
                              <th>Start Date</th>
                              <th>Due Date</th>
                              <th>Goal Type</th>
                              <th>Target</th>
                              <th>Status</th>
                           </tr>
                        </thead>
                        <tbody>
                           {% for i, studentGoalID, timestamp, dueDate, targetedNumber, goalType, goalStatus %}
                           <tr>
                              <td>{{timestamp}}</td>
                              <td>{{dueDate}}</td>
                              <td style="max-width: 40vw; overflow-wrap: break-word; overflow: hidden; text-overflow: ellipsis;">{{goalType}}</td>
                              <td>{{targetedNumber}}</td>                              
                              <td>{{goalStatus}}</td>
                              <td>
                                    <a class="dropdown-button tooltipped secondary-content" href="#!" data-constrainwidth="false" data-beloworigin="true" data-activates='dropdown-{{i}}' data-position="right" data-delay="50" data-tooltip="Options"><i class="material-icons">more_vert</i></a>                                
                                    <ul id='dropdown-{{i}}' class='dropdown-content'>
                                       {% csrf_token %} 
                                       {% if q_type_name == 'multipleChoice' %}
                                       <li><a href="/oneUp/instructors/forms/MultipleChoiceForm?questionId={{q_ID}}&challengeID={{challengeID}}">Edit</a></li>
                                       {% endif %}
                                       {% if q_type_name == 'multipleAnswers' %}
                                       <li><a href="/oneUp/instructors/forms/MultipleAnswersForm?questionId={{q_ID}}&challengeID={{challengeID}}">Edit</a></li>
                                       {% endif %}
                                       {% if q_type_name == 'matching' %}
                                       <li><a href="/oneUp/instructors/forms/MatchingForm?questionId={{q_ID}}&challengeID={{challengeID}}">Edit</a></li>
                                       {% endif %}
                                       {% if q_type_name == 'trueFalse' %}
                                       <li><a href="/oneUp/instructors/forms/TrueFalseForm?questionId={{q_ID}}&challengeID={{challengeID}}">Edit</a></li>
                                       {% endif %}
                                       {% if q_type_name == 'parsons' %}
                                       <li><a href="/oneUp/instructors/forms/ParsonsForm?questionId={{q_ID}}&challengeID={{challengeID}}">Edit</a></li>
                                       {% endif %}
                                       {% if q_type_name == 'dynamic' %}
                                       <li><a href="/oneUp/instructors/forms/DynamicQuestionForm?questionId={{q_ID}}&challengeID={{challengeID}}">Edit</a></li>
                                       {% endif %}
                                       {% if q_type_name == 'templatedynamic' %}
                                       <li><a href="/oneUp/instructors/forms/TemplateDynamicQuestionForm?questionId={{q_ID}}&challengeID={{challengeID}}">Edit</a></li>
                                       {% endif %}
                                       <li class="divider"></li>
                                       <li><a class="modal-trigger" href="#modal_delete-{{i}}">Delete</a></li>
                                    </ul>
                                    <div id="modal_delete-{{i}}" class="modal">
                                       <div class="modal-content">
                                          <h5>Are you sure you want to delete?</h5>
                                       </div>
                                       <div class="modal-footer">
                                          <a href="#!" class="modal-action modal-close waves-effect waves-light btn-flat" style="color: #00bcd4">Cancel</a>
                                          <button class="modal-action modal-close waves-effect waves-light btn-flat" type="button" {% if challenge %}onclick="deleteQuestion({{q_ID}},{{challengeID}})" {%else%}onclick="deleteQuestion({{q_ID}}, 0)" {%endif%}value="Delete">Delete
                                          </button>                                        
                                       </div>
                                    </div>
                              </td>
                           </tr>
                           {% empty %}
                           <tr>
                              <td class="center-align" colspan="3"><i>No Problems Created</i></td>
                           </tr>
                           {% endfor %}
                        </tbody>
                        
                     </table>
                  </div>
                  
                  <div class="card-action right-align">
                     {% if warmUp %}
                     <a class="waves-effect waves-light btn" href="/oneUp/instructors/warmUpChallengeList"><i class="material-icons left">navigate_before</i>Back</a>
                     {% elif serious %}
                     <a class="waves-effect waves-light btn" href="/oneUp/instructors/challengesList"><i class="material-icons left">navigate_before</i>Back</a>
                     {% endif %}
                  </div>
               </div>
            </div>
         </div>
      	</form>
      </main>
      {% include 'footer.html' %}
      <script>
                              function deleteQuestion(questionID, challengeID) {
                            	  var xhttp = new XMLHttpRequest();
                            	  {% if not unassign %}
                            	  xhttp.open("POST", "/oneUp/instructors/deleteQuestionFromChallenge", true);
                            	  xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                            	  xhttp.send("questionId="+questionID+"&challengeID="+challengeID+"&csrfmiddlewaretoken={{csrf_token}}");
                            	  {% else %}
                            	  xhttp.open("POST", "/oneUp/instructors/deleteQuestion", true);
                            	  xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                            	  xhttp.send("questionId="+questionID+"&csrfmiddlewaretoken={{csrf_token}}");
                            	  {% endif %}
                                  xhttp.onload = function(){
                                      location.reload();
                                  }
                            	}
                              </script>
   </body>
</html>