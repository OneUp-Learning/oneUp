<!DOCTYPE html>
<html lang="en">

<head>
   {% include 'scripts.html' %}
</head>
<style>
   .flip {
    position: relative;
   }
   .flip > .front, .flip > .back {
      display: block;
      transition-timing-function: cubic-bezier(0.175, 0.885, 0.32, 1.275);
      transition-duration: 0.5s;
      transition-property: transform, opacity;
   }
   .flip > .front {
      transform: rotateY(0deg);
   }
   .flip > .back {
      position: absolute;
      opacity: 0;
      top: 0px;
      left: 0px;
      width: inherit;
      height: 100%;
      transform: rotateY(-180deg);
   }
   .flip.active > .front {
      transform: rotateY(180deg);
      opacity: 0;
   }
   .flip.active > .back {
      opacity: 1;
      transform: rotateY(0deg);
   }
   .flip.flip-vertical > .back {
      transform: rotateX(-180deg);
   }
   .flip.flip-vertical.active > .front {
      transform: rotateX(180deg);
   }
   .flip.flip-vertical.active > .back {
      transform: rotateX(0deg);
   }
   .flip {
      position: relative;
      display: inline-block;
      margin-right: 2px;
      margin-bottom: 1em;
      width: 100%;
   }
   .flip > .front, .flip > .back {
      display: block;
      width: inherit;
      /* can have fixed height here if you want but you should enable scrolling */
      /* height: 220px; */
      padding: 1em 2em;
      /* background: #313131; */
      border-radius: 10px !important;
   }
 
</style>
<script>
   let flash_cards = {{ flash_range| safe}};
   let correct_flash_cards = [];
   let wrong_flash_cards = [];
   let flash_card_counter = 0;
   let groupID = {{ groupID| safe}};

   const buttonType = Object.freeze({"gotIt":1, "tryAgain":2})
   Object.freeze(buttonType);

   function loadCard() {
      let question_tag = document.getElementById('question');
      let answer_tag = document.getElementById('answer');
      question_tag.innerHTML = flash_cards[flash_card_counter]['question'];
      answer_tag.innerText = flash_cards[flash_card_counter]['answer'];
      answer_tag.style.display = 'none';
   }
   window.onload = loadCard;

   $(document).ready(function(){
      $('.flip').click((el) => {
         console.log(el);
         $(el.currentTarget).toggleClass('active')
      })
   });

   

   function buttonClickedByStudent(type) {
      let xhttp = new XMLHttpRequest();
      let flashID = document.getElementById("flashCard").getAttribute("flashID");
      xhttp.open("POST", "/oneUp/students/flashCardUsed", true);
      xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

      let didTheyGetItFlag = null;
      let actualButtonType;
      if(buttonType.gotIt == type)
         didTheyGetItFlag = true;
      if(buttonType.tryAgain == type)
         didTheyGetItFlag = false;

      xhttp.send("flashID=" + flashID + "&gotIt="+ didTheyGetItFlag + "&groupID=" + groupID + "&csrfmiddlewaretoken={{csrf_token}}");
      xhttp.onreadystatechange = function () {
         if (xhttp.readyState == 4) {
            let responseText = JSON.parse(xhttp.responseText);
            console.log("reponseText" + responseText);
            //let hintID = responseText['hintID'];
            if(didTheyGetItFlag==false)
               placeWrongCardInList(flashID)
            moveToNextCard();
            //it should respond by moving card up a bin
         }
      }
   }

   function placeWrongCardInList(flashID){
      wrong_flash_cards.push(flashID);
   }
   
   function moveToNextCard(){
      flash_card_counter++;
      loadCard();
   }
</script>

<body>
   {% include 'stheading.html' %}
   <main>
      <div class="row center-align">
         <div class="col s12 m10 offset-m1">
            <h3 style="overflow-wrap: break-word; overflow: hidden; text-overflow: ellipsis;">{{group_name}}</h3>
         </div>
      </div>
      <div class="row">
         <div class="col s12 m6 offset-m3">
            <div class="row" style="display: flex; justify-content: center;">
               <div class="flip" id="flash-card">
                  <div class="front card">
                     <p id="question" class="flow-text">{{card.question}}</p>
                  </div>
                  <div class="back card">
                     <p id="answer" class="flow-text">{{card.answer}}</p>
                  </div>
            </div>
            </div>
               <div class="row center-align">
                  <button onclick="buttonClickedByStudent(1);" class="green btn waves-effect waves-light"><i
                        class="material-icons right">check</i>I Got It</button>
                  <button onclick="buttonClickedByStudent(2);" class="red btn waves-effect waves-light"><i
                        class="material-icons right">close</i>Try Again</button>
                  <button onclick="location.href='FlashCardsList'" class="btn waves-effect waves-light"><i
                           class="material-icons right">arrow_back</i>Return</button>
               </div>
            </div>
      </div>

   </main>
   {% include 'footer.html' %}
</body>

</html>