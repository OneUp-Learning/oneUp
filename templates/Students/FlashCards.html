<!DOCTYPE html>
<html lang="en">

<head>
   {% include 'scripts.html' %}
</head>
<style>
   .flip {
    position: relative;
   }
   .flip > .front, .flip > .back {
      display: block;
      transition-timing-function: cubic-bezier(0.175, 0.885, 0.32, 1.275);
      transition-duration: 0.5s;
      transition-property: transform, opacity;
   }
   .flip > .front {
      transform: rotateY(0deg);
   }
   .flip > .back {
      position: absolute;
      opacity: 0;
      top: 0px;
      left: 0px;
      width: inherit;
      height: 100%;
      transform: rotateY(-180deg);
   }
   .flip.active > .front {
      transform: rotateY(180deg);
      opacity: 0;
   }
   .flip.active > .back {
      opacity: 1;
      transform: rotateY(0deg);
   }
   .flip.flip-vertical > .back {
      transform: rotateX(-180deg);
   }
   .flip.flip-vertical.active > .front {
      transform: rotateX(180deg);
   }
   .flip.flip-vertical.active > .back {
      transform: rotateX(0deg);
   }
   .flip {
      position: relative;
      display: inline-block;
      margin-right: 2px;
      margin-bottom: 1em;
      width: 100%;
   }
   .flip > .front, .flip > .back {
      display: block;
      width: inherit;
      /* can have fixed height here if you want but you should enable scrolling */
      /* height: 220px; */
      padding: 1em 2em;
      /* background: #313131; */
      border-radius: 10px !important;
   }
 
</style>
<script>
   let flash_cards = {{ flash_range| safe}};
   let flash_card_counter = 0;
   let groupID = {{ groupID| safe}};

   const buttonType = Object.freeze({"gotIt":1, "tryAgain":2})
   Object.freeze(buttonType);

   function actionButtons(showOrHide){
      let gotItButton = document.getElementById("gotItButton");
      let tryAgain = document.getElementById("tryAgainButton");

      if(showOrHide == "show"){
         tryAgain.style.display = 'inline';
         gotItButton.style.display = 'inline';
      }
      if(showOrHide == "hide"){
         tryAgain.style.display = 'none';
         gotItButton.style.display = 'none';
      }
   }

   function loadFirstCard(){
      if(flash_cards.length == 0)
         loadCard("complete");
      else
         loadCard("first_run");
   }

   function loadCard(run_type) {
      let question_tag = document.getElementById('question');
      let answer_tag = document.getElementById('answer');
      let flash_card = document.getElementById("flash-card");

      console.log(flash_card_counter);
      if(run_type == "not_first")
         flash_card.classList.remove('active');
      
      

      if(run_type == "complete"){
         question_tag.innerHTML = "All Done. Good Job. Thanks For Practicing.";
         answer_tag.innerHTML = "All Done. Good Job. Thanks For Practicing.";
         let card_panel = document.getElementById("flash-card");
         card_panel.setAttribute("onclick", "location.href='FlashCardsList'");
      }else{
         let flashID = flash_cards[flash_card_counter]['flashID'];
         question_tag.setAttribute("flashid", flashID);
         question_tag.innerHTML = flash_cards[flash_card_counter]['question'];
         answer_tag.innerText = flash_cards[flash_card_counter]['answer'];
      }
      actionButtons("hide");
      
   }
   window.onload = loadFirstCard;

   $(document).ready(function(){
      $('.flip').click((el) => {
         console.log(el);
         $(el.currentTarget).toggleClass('active')
      })
   });

   

   function buttonClickedByStudent(buttonType) {
      let xhttp = new XMLHttpRequest();
      let flashID = document.getElementById("question").getAttribute("flashid");
      xhttp.open("POST", "/oneUp/students/flashCardUsed", true);
      xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

      didTheyGetItFlag = didTheyGetIt(buttonType)

      xhttp.send("flashID=" + flashID + "&gotIt="+ didTheyGetItFlag + "&groupID=" + groupID + "&csrfmiddlewaretoken={{csrf_token}}");
      xhttp.onreadystatechange = function () {
         if (xhttp.readyState == 4) {
            moveToNextCard();
         }
      }
   }

   function didTheyGetIt(typeOfButtonPressed){
      let didTheyGetItFlag = null;
      if(buttonType.gotIt == typeOfButtonPressed)
         didTheyGetItFlag = true;
      if(buttonType.tryAgain == typeOfButtonPressed)
         didTheyGetItFlag = false;
      return didTheyGetItFlag;
   }
   
   function moveToNextCard(){
      if(flash_card_counter == flash_cards.length-1){
         loadCard("complete");
      }else{
         flash_card_counter++;
         loadCard("not_first");
      }
      
   }
</script>

<body>
   {% include 'stheading.html' %}
   <main>
      <div class="row center-align">
         <div class="col s12 m10 offset-m1">
            <h3 style="overflow-wrap: break-word; overflow: hidden; text-overflow: ellipsis;">Can you answer this question?</h3>
         </div>
      </div>
      <div class="row">
         <div class="col s12 m6 offset-m3">
            <div class="row" style="display: flex; justify-content: center;">
               <div class="flip" id="flash-card" onclick="actionButtons('show');">
                  <div class="front card">
                     <p id="question" flashID="none" class="flow-text">{{card.question}}</p>
                  </div>
                  <div class="back card">
                     <p id="answer" class="flow-text">{{card.answer}}</p>
                  </div>
               </div>
            </div>
               <div class="row center-align">
                  <button style="display:none;" id="gotItButton" onclick="buttonClickedByStudent(1);" class="green btn waves-effect waves-light"><i
                        class="material-icons right">check</i>I Got It</button>
                  <button style="display:none;" id="tryAgainButton" onclick="buttonClickedByStudent(2);" class="red btn waves-effect waves-light"><i
                        class="material-icons right">close</i>Try Again</button>
                  <button onclick="location.href='FlashCardsList'" class="btn waves-effect waves-light"><i
                           class="material-icons right">arrow_back</i>Return</button>
               </div>
            </div>
      </div>

   </main>
   {% include 'footer.html' %}
</body>

</html>