<!DOCTYPE html>
<html lang="en">
   <head>
        <link href="/static/ThirdParty/js-parsons-master/parsons.css" rel="stylesheet" />
        <link href="/static/ThirdParty/js-parsons-master/lib/prettify.css" rel="stylesheet" />
      {% include 'scripts.html' %}
      <script>
         jQuery.browser = {};
         (function () {
         jQuery.browser.msie = false;
         jQuery.browser.version = 0;
         if (navigator.userAgent.match(/MSIE ([0-9]+)\./)) {
         jQuery.browser.msie = true;
         jQuery.browser.version = RegExp.$1;
         }
         })();
      </script>
      
      <script src="/static/ThirdParty/js-parsons-master/lib/prettify.js"></script>
      <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.min.js"></script>
      <script src="/static/ThirdParty/js-parsons-master/lib/jquery.ui.touch-punch.min.js"></script>
      <script src="/static/ThirdParty/js-parsons-master/lib/underscore-min.js"></script>
      <script src="/static/ThirdParty/js-parsons-master/lib/lis.js"></script>
      {% include "../Students/parson.html" %}
      <script src="/static/ThirdParty/ckeditor_4.6.2_custom1/ckeditor.js"></script>
      <script src="/static/ThirdParty/aceEditor/src-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
      <script type="text/javascript">
         // Set time out for the test if the time limit has reached 
         var duration = {{testDuration}}; //time limit in minutes from database
         var now = new Date();
         var milli = now.getMilliseconds(); //current time in milliseconds
         var limit = milli + (duration * 1000 * 60); // test time duration in milliseconds (current time + time limit in milliseconds)
         
         setTimeout("formSubmit()", limit); //if the time limit of the test has reached, the test will be submitted automatically
         
         function formSubmit() {
             document.getElementById('submit_hidden').click()
         };
         
         
      </script>

    <style>
    /*
Copyright (c) 2003-2017, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.md or http://ckeditor.com/license
*/

.ck-view img:not([width]) {
    width: 100%;
}
.ck-view img {
    max-width: 100%;
}
.ck-view table {
    border-collapse: collapse;
    border-spacing: 2px;
    border: 1px solid #ccc;
    width: initial;
}
.ck-view table td {
    border: 1px solid black;
}
.ck-view .ck-compact-table {
    border-collapse: collapse;
    border-spacing: 2px;
    border: 1px solid #ccc;
    width: initial;
}
.ck-view .ck-compact-table td {
    border: 1px solid #ccc;
}
.ck-view body
{
	/* Font */
	font-family: sans-serif, Arial, Verdana, "Trebuchet MS";
	font-size: 12px;

	/* Text color */
	color: #333;

	/* Remove the background color to make it transparent */
	background-color: #fff;

	margin: 20px;
}

.ck-view .cke_editable
{
	font-size: 13px;
	line-height: 1.6;

	/* Fix for missing scrollbars with RTL texts. (#10488) */
	word-wrap: break-word;
}

.ck-view blockquote
{
	font-style: italic;
	font-family: Georgia, Times, "Times New Roman", serif;
	padding: 2px 0;
	border-style: solid;
	border-color: #ccc;
	border-width: 0;
}

.ck-view .cke_contents_ltr blockquote
{
	padding-left: 20px;
	padding-right: 8px;
	border-left-width: 5px;
}

.ck-view .cke_contents_rtl blockquote
{
	padding-left: 8px;
	padding-right: 20px;
	border-right-width: 5px;
}

.ck-view a
{
	color: #0782C1;
}

.ck-view ol, .ck-view ul, .ck-view dl
{
	/* IE7: reset rtl list margin. (#7334) */
	margin-right: 0px;
	/* preserved spaces for list items with text direction other than the list. (#6249,#8049)*/
	padding: 0 40px;
}

.ck-view h1, .ck-view h2,
.ck-view h3, .ck-view h4,
.ck-view h5, .ck-view h6
{
	font-weight: normal;
    line-height: 1.2;
}

.ck-view hr
{
	border: 0px;
	border-top: 1px solid #ccc;
}

.ck-view img.right
{
	border: 1px solid #ccc;
	float: right;
	margin-left: 15px;
	padding: 5px;
}

.ck-view img.left
{
	border: 1px solid #ccc;
	float: left;
	margin-right: 15px;
	padding: 5px;
}

.ck-view pre
{
	white-space: pre-wrap; /* CSS 2.1 */
	word-wrap: break-word; /* IE7 */
	-moz-tab-size: 4;
	tab-size: 4;
}

.ck-view .marker
{
	background-color: Yellow;
}

.ck-view span[lang]
{
	font-style: italic;
}

.ck-view figure
{
	text-align: center;
	border: solid 1px #ccc;
	border-radius: 2px;
	background: rgba(0,0,0,0.05);
	padding: 10px;
	margin: 10px 20px;
	display: inline-block;
}

.ck-view figure > figcaption
{
	text-align: center;
	display: block; /* For IE8 */
}

.ck-view a > img {
	padding: 1px;
	margin: 1px;
	border: none;
	outline: 1px solid #0782C1;
}

/* Widget Styles */
.ck-view .code-featured
{
	border: 5px solid red;
}

.ck-view .math-featured
{
	padding: 20px;
	box-shadow: 0 0 2px rgba(200, 0, 0, 1);
	background-color: rgba(255, 0, 0, 0.05);
	margin: 10px;
}

.ck-view .image-clean
{
	border: 0;
	background: none;
	padding: 0;
}

.ck-view .image-clean > figcaption
{
	font-size: .9em;
	text-align: right;
}

.ck-view .image-grayscale
{
	background-color: white;
	color: #666;
}

.ck-view .image-grayscale img, .ck-view img.image-grayscale
{
	filter: grayscale(100%);
}

.ck-view .embed-240p
{
	max-width: 426px;
	max-height: 240px;
	margin:0 auto;
}

.ck-view .embed-360p
{
	max-width: 640px;
	max-height: 360px;
	margin:0 auto;
}

.ck-view .embed-480p
{
	max-width: 854px;
	max-height: 480px;
	margin:0 auto;
}

.ck-view .embed-720p
{
	max-width: 1280px;
	max-height: 720px;
	margin:0 auto;
}

.ck-view .embed-1080p
{
	max-width: 1920px;
	max-height: 1080px;
	margin:0 auto;
}

    </style>
   </head>
   <body>
      {% include 'stheading.html' %}
      <main>
         <div class="row center-align">
            <div class="col s12">
               <h3>{{challengeName}}</h3>
               <p><b> Start Time:  {{startTime}}</b></p>
            </div>
         </div>
         <div class="row">
            <div class="col s12 l12 m8 offset-m2">
               <form id="TakeTest" name="TakeTest" action="/oneUp/students/ChallengeResults" method="POST">
                  {% csrf_token %}
                  <input type="hidden" name="startTime" id="startTime" value="{{startTime}}">
                  <input type="hidden" name="challengeId" value="{{challengeID}}"> 
                  <div class="card">
                     <div class="card-content">
                        {% for i,question in question_range %}
                        {% if i != 1 %}
                        <div class="divider"></div>
                        {% endif %}
                        <div class="row">
                            {{i}}. <div class="ck-view"> {{question.questionText|safe}} </div>
                        </div>
                        {% if question.type == questionTypes.multipleChoice %}
                        <div class="row">
                           <div class="col s12">
                              {% for j,answer in question.answers_with_count %}
                              <div class="row">
                                 <input name="{{i}}-ans" type="radio" id="{{i}}ans-{{j}}" value="{{j}}" />
                                 <label for="{{i}}ans-{{j}}">{% autoescape off %}{{answer.answerText|safe}} {% endautoescape %}</label>
                              </div>
                              {% endfor %}
                           </div>
                        </div>
                        {% elif question.type == questionTypes.multipleAnswers %}
                        <div class="row">
                           <div class="col s12">
                              {% for j,answer in question.answers_with_count %}
                              <div class="row">
                                 <input name="{{i}}-ans" type="checkbox" id="{{i}}ans-{{j}}" value="{{j}}"/>
                                 <label for="{{i}}ans-{{j}}">{% autoescape off %}{{answer.answerText|safe}} {% endautoescape %}</label>
                              </div>
                              {% endfor %}
                           </div>
                        </div>
                        {% elif question.type == questionTypes.matching %}
                        <div class="row">
                           <div class="col s12 m6">
                              {% for j,answer in question.answers_with_count %}
                              <p>{{j}} . {{answer.answerText}}</p>
                              {% endfor %}
                           </div>
                        </div>
                        <div class="row">
                           {% for match in question.matches %}
                           <div class="input-field col s12 m4">
                              <select name="{{i}}-{{match.current_pos}}" id={{match.current_pos}}/>
                                 {% for k in match.answers_count %}
                                 <option value="{{k}}">{{k}}</option>
                                 {% endfor %}
                              </select>
                              <label for="{{match.current_pos}}">{{match.matchingAnswerText}}</label>
                           </div>
                           {% endfor %}
                        </div>
                        {% elif question.type == questionTypes.trueFalse  %}
                        <div class="row">
                           <div class="col s12">
                              <p>
                                 <input name="{{i}}-ans" type="radio" id="{{i}}ans1" value="t" class="validate" required/>
                                 <label for="{{i}}ans1">True</label>
                              </p>
                              <p> 
                                 <input name="{{i}}-ans" type="radio" id="{{i}}ans2" value="f" class="validate" required/>
                                 <label for="{{i}}ans2">False</label>
                              </p>
                           </div>
                        </div>
                         <div class="divider"></div>
                        {% elif question.type == questionTypes.essay %}
                        <div class="row">
                           <div class="col s12">
                              <textarea style="border:solid 1px rgba(128, 128, 128, 0.5)" name="{{i}}-ans" rows="10" cols="90"></textarea>
                              <script type="text/javascript">
                                 CKEDITOR.config.autoParagraph = false;
                                 CKEDITOR.replace("{{question.questionID}}");
                              </script>
                           </div>
                        </div>
                        {% elif question.type == questionTypes.parsons %} 
                        <div class="row">
                           <div>
                              <div id="{{question.questionID}}_sortableTrash" class="sortable-code"></div>
                              <div id="{{question.questionID}}_sortable" class="sortable-code"></div>
                              <input type="hidden" name="{{i}}lineNo" id="{{question.questionID}}_lineNo" value="">
                              <input type="hidden" name="{{i}}errorDescription" id="{{question.questionID}}_errorDescription" value="">
                              <input type="hidden" name="{{i}}studentSol" id="{{question.questionID}}_studentSol" value="">
                              <input type="hidden" name="{{i}}lineIndent" id="{{question.questionID}}_lineIndent" value="">
                              <input type="hidden" name="{{i}}correctLineCount" id="{{question.questionID}}_correctLineCount" value="">
                              <input type="hidden" name="{{i}}feedBackButtonClickCount" id="{{question.questionID}}_feedBackButtonClickCount" value="">
                              <div style="clear:both;"></div>
                              <p>
                                 <a href="#{{question.questionID}}" id="newInstanceLink_{{question.questionID}}">New instance</a>
                                 {% if warmUp == 1%}
                                 <a href="#{{question.questionID}}" id="feedbackLink_{{question.questionID}}">Get feedback</a>
                                 {% endif %}
                              </p>
                              <script>
                                 //initial will hold the parson problem text, preformatted by django
                                    var initial_{{question.questionID}} = '{{question.model_solution}}' 
                                    
                                    //variable to get the errors statements that have been generated
                                    var logged_errors_{{question.questionID}} = [];
                                    var countFeedbackButtonClicks_{{question.questionID}} = 0;
                                    var submit_clicked_{{question.questionID}} = false;
                                    var isGraded = false;
                                    var displayCorrectAnswerFeedback = false;
                                    var displayIncorrectAnswerFeedback = false;
                                    
                                    
                                    function displayErrors{{question.questionID}}(fb_{{question.questionID}}) {
                                        if(fb_{{question.questionID}}.errors.length > 0) {
                                        	{% if warmUp == 1%}
                                            alert(fb_{{question.questionID}}.errors[0]);
                                            {% endif %}
                                            console.log("Caller: {{question.questionID}}" );
                                 logged_errors_{{question.questionID}}.push(errors);
                                 
                                        }else{
                                        	if(submit_clicked_{{question.questionID}} == false){
                                        		countFeedbackButtonClicks_{{question.questionID}}--;
                                        	}
                                        }
                                    } 
                                 
                                 
                                    $(document).ready(function(){
                                    	   
                                        var parson_{{question.questionID}} = new ParsonsWidget({
                                            'sortableId': '{{question.questionID}}_sortable',
                                            'trashId': '{{question.questionID}}_sortableTrash',
                                            'max_wrong_lines': {{question.distractorCount}},
                                            'feedback_cb' : displayErrors{{question.questionID}},
                                            'programmingLang': "{{question.languageName}}"
                                            
                                        });
                                        parson_{{question.questionID}}.init(initial_{{question.questionID}});
                                        parson_{{question.questionID}}.shuffleLines();
                                        $("#newInstanceLink_{{question.questionID}}").click(function(event){
                                            event.preventDefault();
                                            parson_{{question.questionID}}.shuffleLines();
                                        });
                                        $("#feedbackLink_{{question.questionID}}").click(function(event){
                                        	feedbackFunction_{{question.questionID}}();
                                        });
                                        
                                        //on click display the contents of the student error log
                                        $("#submit").click(function(event){
                                        	
                                        	submit_clicked_{{question.questionID}} = true;
                                        	//we click the link here too, and it should not be counted against the student
                                        	{% if warmUp == 1%}
                                        	console.log("warmup is 1");
                                        	document.getElementById("feedbackLink_{{question.questionID}}").click();
                                        	{% else %}
                                        		console.log("Feeback Function activated!");
                                        		feedbackFunction_{{question.questionID}}();
                                        	{% endif %}
                                 
                                        	console.log("Parson problem: {{question.questionID}}:");
                                        	console.log("submit clicked");
                                       		
                                        	console.log("logged errors: ");
                                       		console.log(logged_errors_{{question.questionID}});
                                       		
                                       		console.log("incorrect lines!");
                                       		console.log(incorrectLines);
                                       		
                                       		console.log("student code lines objects!");
                                       		console.log(studentCodeLineObjects);
                                       		
                                       		//access the student code line objects
                                       		//peel away the object notation to get at the
                                       		//student's code text representation
                                       		var studentCode = [];
                                       		var lineIndentation = [];
                                       		
                                       		for (i = 0; i < studentCodeLineObjects.length; i++) {
                                       			studentCode.push(studentCodeLineObjects[i].code);
                                       			lineIndentation.push(studentCodeLineObjects[i].indent);
                                       		}
                                       		
                                       		console.log("Student code!");
                                       		console.log(studentCode);
                                       		
                                       		console.log("Line indent!");
                                       		console.log(lineIndentation);
                                       		
                                       		console.log("Feedback click count");
                                       		console.log(countFeedbackButtonClicks_{{question.questionID}});
                                       		
                                       		$("#{{question.questionID}}_lineNo").val(incorrectLines);
                                       		$("#{{question.questionID}}_errorDescription").val(logged_errors_{{question.questionID}});
                                       		$("#{{question.questionID}}_studentSol").val(studentCode);
                                       		$("#{{question.questionID}}_lineIndent").val(lineIndentation);
                                       		$("#{{question.questionID}}_correctLineCount").val(parson_{{question.questionID}}.model_solution.length);
                                       		$("#{{question.questionID}}_feedBackButtonClickCount").val(countFeedbackButtonClicks_{{question.questionID}});
                                       	});
                                       		
                                        function feedbackFunction_{{question.questionID}}(){
                                    		event.preventDefault();
                                            //this has to be cleared because otherwise they'll retain data
                                            errors = [], log_errors = [];
                                            studentCodeLineObjects = [];
                                            incorrectLines = [];
                                            
                                            console.log("Submit Clicked state:")
                                            console.log(submit_clicked_{{question.questionID}});
                                            
                                            if(submit_clicked_{{question.questionID}} == false){
                                            	countFeedbackButtonClicks_{{question.questionID}}++;
                                            	console.log("Feeback click state:")
                                            	console.log(countFeedbackButtonClicks_{{question.questionID}});
                                            	
                                            }
                                            console.log("Get Feedback: {{question.questionID}}");
                                            console.log(parson_{{question.questionID}}.getFeedback());
                                            console.log(logged_errors_{{question.questionID}});
                                            submit_clicked_{{question.questionID}} = false;
                                    	}
                                    });
                                    
                              </script>
                           </div>
                        </div>
                        {% endif %}
                        {% endfor %}
                     </div>
                     <div class="card-action right-align">
                        <input type="submit" id="submit_hidden" name="submit_hidden" style="display:none;">
                        <a id="submit" class="waves-effect waves-light btn modal-trigger" href="#modal_confirm"><i class="material-icons right">send</i>Submit Challenge</a></a>
                        <div id="modal_confirm" class="modal">
                           <div class="modal-content left-align">
                              <h5>Are you sure you want to submit?</h5>
                              <p>Once you submit the challenge, it cannot be reverted.</p>
                           </div>
                           <div class="modal-footer">
                              <a href="#!" class="modal-action modal-close waves-effect waves-light btn-flat">Cancel</a>
                              <button class="modal-action modal-close waves-effect waves-light btn-flat" type="submit" id="submit" name="submit" value="Submit" onclick="copyContentsToHidden()">Submit
                              </button>                                        
                           </div>
                        </div>
                     </div>
                  </div>
               </form>
            </div>
         </div>
      </main>
      <!-- Footer -->
      {% include 'footer.html' %}
   </body>
</html>