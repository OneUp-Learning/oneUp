<!DOCTYPE html>
<html lang="en">
<head>
    {% include 'scripts.html' %}
    <script src="/static/ThirdParty/ckeditor_4.6.2_custom1/ckeditor.js"></script>
    <script src="/static/ThirdParty/aceEditor/src-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>
    <div>
        {% include 'stheading.html' %}
        <script>
        	// Disables links on the navigation bar so the user cannot go to another page without submitting
        	var navigation = document.getElementsByClassName("Navigation")[0];
        	var links = navigation.getElementsByTagName('a');
        	for (var i=0, end=links.length; i<end; i++) {
       	      links[i].onclick = function() {
       	        return false;
       	      };
        	}
        </script>
        <div class="frame" id="grad" align="center">
            <div class="container">
                <div class="row">
                    <div class="12u">

                        <h1>Challenges</h1>
                        <h3>{{challengeName}}</h3>
          				<p><center><b> Start Time:  {{startTime}}</b></center></p>                        
                    </div>
                </div>
                <div class="row">
                    <div class="12u">
                        <form id="TakeTest" name="TakeTest" action="/oneUp/students/ChallengeResults" method="POST">
                            <input type="hidden" name="startTime" id="startTime" value="{{startTime}}">
                            <input type="hidden" name="challengeId" value="{{challengeID}}"> {% csrf_token %}
                            <table class="bg">
                                <!-- Note that this was bg challenge but Joel changed it to bg to get color alteration  -->

                                {% for i,question in question_range %}

                                <tr id="question" style="background-color: rgba(144, 144, 144, 0.075);">
                                    <td colspan="2" style="text-align:left">

                                        {% autoescape off %} {{i}}. {{question.questionText|safe}} {% endautoescape %}
                                    </td>

                                </tr>
                                {% if question.type == questionTypes.multipleChoice %}
                                <tr style="background-color: #fff;">
                                    <td colspan="2">
                                        {% for j,answer in question.answers_with_count %}
                                        <!-- use a for loop and display the answers in radio buttons -->
                                        <label>
                                            <input type="radio" name="{{i}}-ans" value="{{j}}"> 
                                            {% autoescape off %}{{answer.answerText|safe}} {% endautoescape %}
                                            
                                          
                                        {% endfor %}
                                    </td>
                                </tr>
                                {% elif question.type == questionTypes.multipleAnswers %}
                                <tr style="background-color: #fff;">
                                    <td colspan="2">{% for j,answer in question.answers_with_count %}
                                        <!-- use a for loop and display the answers in the check box -->
                                        <label>
                                            <input type="checkbox" name="{{i}}-ans[]" value="{{j}}">
                                             {% autoescape off %}{{answer.answerText|safe}} {% endautoescape %}
                                            
                                         </label>
                                        {% endfor %}</td>
                                </tr>
                                {% elif question.type == questionTypes.matching %}
                                <tr style="background-color: #fff;">
                                    <td>{% for j,answer in question.answers_with_count %}
                                        <!-- use a for loop and display the answers in the matching form -->
                                        {{j}} . &nbsp; {{answer.answerText}}
                                        <br> {% endfor %}
                                    </td>
                                    <td>
				      				  {% for match in question.matches %}
                                        <select name="{{i}}-{{match.current_pos}}" style="float:left;height:initial"/>
                                        {% for k in match.answers_count %}
                                           <option value="{{k}}">{{k}}</option>
                                        {% endfor %}
                                        </select>
                                        &nbsp;&nbsp;{{match.matchingAnswerText}}
                                        <br />
                                      {% endfor %}
                                    </td>
                                </tr>
                                {% elif question.type == questionTypes.trueFalse  %}
                                <tr style="background-color: #fff;">
                                    <td colspan="2">
                                        <label>
                                            <input type="radio" name="{{i}}-ans" value="t">True</label>
                                        <label>
                                            <input type="radio" name="{{i}}-ans" value="f">False</label>
                                    </td>
                                </tr>
                                {% elif question.type == questionTypes.essay %}
                                <tr style="background-color: #fff;">
                                    <td colspan="2">
                                        <textarea style="border:solid 1px rgba(128, 128, 128, 0.5)" name="{{i}}-ans" rows="10" cols="90">
                                        </textarea>
                                        <script type="text/javascript">
                                            // Replace the <textarea id="questionText"> with a CKEditor instance, using default configuration.
                                            CKEDITOR.replace("{{question.questionID}}");
                                        </script>

                                    </td>
                                </tr>
                                {% endif %}
                                {% endfor %}
                                <script type="text/javascript">
                                    <!-- Set time out for the test if the time limit has reached -->
                                    var duration = {{testDuration}}; //time limit in minutes from database
                                    var now = new Date();
                                    var milli = now.getMilliseconds(); //current time in milliseconds
                                    var limit = milli + (duration * 1000 * 60); // test time duration in milliseconds (current time + time limit in milliseconds)

                                    setTimeout("formSubmit()", limit); //if the time limit of the test has reached, the test will be submitted automatically

                                    function formSubmit() {
                                        document.getElementById('submit_hidden').click()
                                    };
                                </script>
                            </table>
                            <td colspan="2">
                                <center>
                                    <input type="submit" id="submit" name="submit" value="Submit Challenge" class="button" onclick="copyContentsToHidden();return confirm('Once you submit the test, it cannot be reverted. Do you want to review it??');">
                                </center>
                            </td>
                            <td colspan="2">
                                <center>
                                    <input type="submit" id="submit_hidden" name="submit_hidden" style="display:none;">
                                </center>
                            </td>
                        </form>
                        <br>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Footer -->
    {% include 'footer.html' %}
    
    <script>
    	var ace_editor_divs = document.getElementsByClassName('ace-editor');
    	var ace_editors = {};
    	for (var i=0;i<ace_editor_divs.length;i++) {
    		var new_editor = ace.edit(ace_editor_divs[i].id);
		    new_editor.setTheme("ace/theme/chrome");
			new_editor.session.setMode("ace/mode/"+ace_editor_divs[i].title);
			ace_editors[ace_editor_divs[i].id] = new_editor;
    	}
    	
    	function copyContentsToHidden() {
        	for (var i=0;i<ace_editor_divs.length;i++) {
        		var name = ace_editor_divs[i].id;
        		var editor = ace_editors[name];
        		var hiddenfield = document.getElementById(name+"-hidden");
        		hiddenfield.value = editor.getValue();
        	}
    	}
    </script>
</body>
</html>
