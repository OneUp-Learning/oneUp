<!DOCTYPE html>
<html lang="en">
   <head>
      {% include 'scripts.html' %}      
      
      <script type="text/javascript" src="/static/ThirdParty/progressbar.js/progressbar.js"></script>
      
      <style type="text/css">
      	
      	.goalindicator {
/*       		position: relative; */
/*       		margin-left: 30% auto; */
/*       		margin-right: 45% auto; */
      		width: 100px;
      		height: 100px;
      	}
      	
/*       	.goalbars {  */
/*       		width: 70%; */
/*       		text-align: center;  */
/*       		border: solid; */
/*       		align: center; */
/*       	} */
      
      </style>
      
   </head>
   <body>
      {% include 'stheading.html' %}
      <main>
         <div class="row">
            <div class="col s12 m12 l10 offset-l1">
               <div class="row">
                  <div class="col s12 m6">
                     <div class="card-panel center-align">
                        <table>
                           <thead>
                              <th>Latest Announcements</th>
                           </thead>
                           <tbody>
                              {% for i,announcement_ID,author_ID,start_Timestamp, end_Timestamp, subject, message in announcement_range %}
                              <tr>
                                 <td style="max-width:24vw; overflow-wrap: break-word; overflow: hidden; text-overflow: ellipsis;">{{subject}}</td>
                                 <td>{{start_Timestamp}}</td>
                              </tr>
                              {% empty %}
                              <tr>
                                 <td class="center-align"><i>No announcements</i></td>
                              </tr>
                              {% endfor %}
                           </tbody>
                        </table>
                        <a class="waves-effect waves-light btn" href="/oneUp/students/Announcements"><i class="material-icons right">navigate_next</i>View All Announcements</a>
                     </div>
                  </div>
                  <div class="col s12 m6">
                     <div class="card-panel center-align">
                        <table>
                           <thead>
                              <th>Upcoming Serious Challenges</th>
                           </thead>
                           <tbody>
                              {% for i,chall_ID,chall_Name,start_Timestamp,due_date in challenge_range %}
                              <tr>
                                 <td class="left" style="max-width:24vw; overflow-wrap: break-word; overflow: hidden; text-overflow: ellipsis;">{{chall_Name}}</td>
                                 <td>{{due_date}}</td>
                              </tr>
                              {% empty %}
                              <tr>
                                 <td class="center-align"><i>No upcoming serious challenges</i></td>
                              </tr>
                              {% endfor %}
                           </tbody>
                        </table>
                        <a class="waves-effect waves-light btn" href="/oneUp/students/ChallengesList"><i class="material-icons right">navigate_next</i>View All Serious Challenges</a>
                     </div>
                  </div>
               </div>
            {% if ccparams.gamificationUsed and ccparams.studCanChangeGoal %}
            <div class="row">
            	<div class="col s12">            
	            	<div class="card-panel">
	            	  <table>
	            	    <thead>
	                        <th>Goals</th>
	                    </thead>
	                    <tbody>
		                    <tr><td>
			            		<div class="row" style="display: flex;">
			            		  <div class="col s12 m6"></div>
			            			{% for i,studentGoal_ID,student_ID,course_ID,start_date,end_date,goal_Type,targeted_Number,goal_progress,goal_status,edit_allowed,recurring_goal in goal_range %}                                                           
			                          <div class="col s12">
			                            <div class="card-panel" style="height:90%">
			                            	<span>End Date: {{end_date}}</span>
			                           		<div class="goalindicator" data-goalprogress="{{goal_progress}}" title="{{goal_Type}} by {{student_ID}}" data-target="100" id="goal_container{{i}}"></div>
			                      			<span>{{goal_Type}}</span>			                      			
			                      		</div>
			                      	  </div>
			                         {% empty %} 
			                            <div class="center-align"><i>No New Goals Created Yet</i></div>
			                         {% endfor %}	
			            	      <div class="col s12 m6"></div>
			            		</div>
		            		</td></tr>
	            		</tbody>
	            	  </table>
	            	  <center><a class="waves-effect waves-light btn" href="/oneUp/students/GoalCreate"><i class="material-icons left">add_circle</i>Create New Goal</a>
	            	  <a class="waves-effect waves-light btn" href="/oneUp/students/GoalsList"><i class="material-icons right">navigate_next</i>View All Goals</a></center>
	            	</div>
           		</div>
            </div>
            {% endif %}
            {% if displayBadges and ccparams.gamificationUsed %}                            
            <div class="row">
                <div class="col s12">
                  <div class="card-panel">
                  <table>
                    <thead>
                      <th>Latest Badges </th>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="display: flex; flex-wrap: wrap;">
                               {% for i,studentBadgeID,studentID,badgeID,badgeName, badgeImage,avatarImage in badgesInfo %} 
                               <div style="padding-right: 16px">                                                       
                               <img class="tooltipped" src="/{{badgeImage}}" alt="Badge Image" width="64px" height="64px" data-position="top" data-delay="50" data-tooltip="{{badgeName}}"/>
                               <img class="tooltipped" alt="Avatar Image" width="30px" height="30px" src="{{avatarImage}}" data-position="top" data-delay="50">
                               </div>
                               {% empty %}
                               <i class="center-align" style="flex: 1;">No badges earned</i>
                               {% endfor %}
                            </td>
                         </tr>
                    </tbody>
                  </table>
                  </div>
                </div>
            </div>
            {% endif %} 
               {% if displayLeaderBoard and ccparams.leaderboardUsed%}
               <div class="row">
                  <div class="col s12 m12">
                  <div class="row" style="display: flex;">
                  <div class="col s12 m6"></div>
                  {% for leaderboardNames, leaderboardDescriptions, leaderboardRankings in leaderboardRange %}  
                  <div class="col s12">
                  <div class="card-panel">
                  <table>
                    <caption><h5>{{leaderboardNames}}</h5></caption>
                    <thead>
                      <th>Student</th>
                      <th>Points</th>
                    </thead>
                    <tbody>
                        {% for i, avatarImage, points, studentUsers in leaderboardRankings %}
                        <tr>
                            <td><img alt="Avatar Image" width="30px" height="30px" src="{{avatarImage}}"></td>
                            <td>{{points}}</td>
                        </tr>
                        {% empty %}
                        <tr><td class="center-align" colspan="2"><i>No students with enough results to place on leaderboard</i></td></tr>
                        {% endfor %}
                    </tbody>
                  </table>
                  </div>
                  </div>
                  
                  {% endfor %} 
                  <div class="col s12 m6"></div>
                  </div>
                  </div>
               </div>   
                {% endif %}              
            </div>
         </div>
      </main>
      {% include 'footer.html' %}
   </body>
</html>

<script>
    window.onload = function(){    	
        var indicatorsFound = document.getElementsByClassName("goalindicator");
        console.log(indicatorsFound.length)
        for(var i = 0; i < indicatorsFound.length; i++){
            createProgressBar(indicatorsFound[i].dataset.goalprogress, indicatorsFound[i].dataset.target, indicatorsFound.item(i));
        }
        var streakIndicators = [];
    }

    function createProgressBar(currentCount ,treshold, objID){
        console.log(treshold);
        console.log(currentCount);
        treshold = parseInt(treshold);
        if (currentCount <= 100){
        	currentCount = parseInt(currentCount);
        }
        else {
        	currentCount = 100;
        }
        var bar = new ProgressBar.Circle(objID, {
      strokeWidth: 6,
      color: '#ADD8E6',
      trailColor: '#000000',
      trailWidth: 1,
      easing: 'easeInOut',
      duration: 1400,
      svgStyle: null,
      text: {
        value: '',
        alignToBottom: false
      },
      from: {color: '#000000'},
      to: {color: '#1df704'},
      // Set default step function for all animate calls
      
      step: (state, bar) => {
        bar.path.setAttribute('stroke', state.color);
        var value = Math.round(bar.value() * treshold);
        console.log(value)
        if (value === 0) {
          bar.setText('0');
        } else if(value >= currentCount){
            bar.stop();    
        }
        else{
          bar.setText((currentCount / treshold) * 100 + " %");
        }
    
        bar.text.style.color = state.color;
      }
    });
    bar.text.style.fontFamily = '"Raleway", Helvetica, sans-serif';
    bar.text.style.fontSize = '1rem';
    
    bar.animate(1.0);  // Number from 0.0 to 1.0
    }
</script>