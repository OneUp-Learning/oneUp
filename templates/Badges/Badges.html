<!DOCTYPE html>
<html lang="en">

<head>
    {% include 'scripts.html' %}
</head>

<body>
    {% include 'heading.html' %}
    <main>
        <div class="row center-align">
            <div class="col s12">
                <h3>Badges</h3>
            </div>
        </div>
            {% csrf_token %}
            
            <!--  added a title GGM -->
            <div class="row">
                <div class="col s12 m5 offset-m1">
                    <h5>Automatic Rule Badges</h5>
                </div>
                <div class="col s12 m5  right-align">
                    <a class="waves-effect waves-light btn" href="/oneUp/badges/EditDeleteBadge?isManualBadge=false">
                        <i class="material-icons left">add_circle</i>Add AN AUTOMATIC BADGE</a>
                </div>
                <!-- Added a second button to the page so we can have buttons without conditions for manual usgage GGM -->
            </div>
            <div class="row">
                <div class="col s12 m10 offset-m1">
                        <div class="card-content">
                          <ul id="sortableAutoBadges" class="collapsible" >
                
                                    {% for i,badgeId,badgeName,badgeImage, badgeDescription, badgePosition in badgesInfo %}
                                    
                                    <li id={{badgeId}}>
                                    <div class="collapsible-header" > <i style="justify-content: center; align-item: center" class="material-icons">swap_vert</i> 
                                        <span style="max-width: 7%;min-width: 7%; left: 0px">
                                            <img src="/{{badgeImage}}" alt="Badge Image" width="50px" height="50px">
                                        </span>
    
                                        <span style="max-width: 30%;min-width: 30%; left: 0px">{{badgeName}}</span>
                                        <span style="max-width: 45%;min-width: 45%; left: 0px"> {{badgeDescription}}</span>
                                        
                                        <span class="right-align" style="max-width: 15%;min-width: 15%;">
                                            <a class="waves-effect waves-light btn" href="/oneUp/badges/EditDeleteBadge?badgeID={{badgeId}}"> Modify</a>
                                        </span>
                                    </li>
                                    {% empty %}
                                    <li>
                                        <div class="center-align" colspan="4">
                                            <i>No badges created</i>
                                        </div>
                                    </li>
                                    {% endfor %}
                                </li>
                            </ul>
                            <script>
										$( function() {
											$( "#sortableAutoBadges" ).sortable({

												stop: function(event, ui) {

												var itemOrder = $("#sortableAutoBadges").sortable("toArray");

												var idsPositions = []

												for (var i = 0; i < itemOrder.length; i++) {
													if (itemOrder[i]){
														idsPositions.push(String(itemOrder[i])+"---"+String(i));
													}
												}

												var csrftoken = $('input[name="csrfmiddlewaretoken"]').val();

												console.log(idsPositions)

												$.post( "/oneUp/instructors/ReorderBadges", {badgeIdsPositions: idsPositions , csrfmiddlewaretoken: csrftoken,}, function( data ) {
													console.log(data)
												});

												}
												});
											});
										</script>
                        </div>
                    </div>
                </div>

            <!-- created a second table to display the badge content GGM-->
            <div class="row">
                <div class="col s12 m5 offset-m1">
                    <h5>Manual Badges</h5>
                </div>
                <div class="col s12 m5  right-align">
                    <a class="waves-effect waves-light btn" href="/oneUp/badges/EditDeleteBadge?isManualBadge=true">
                        <i class="material-icons left">add_circle</i>Add A Manual Badge</a>
                </div>
                <!-- Added a second button to the page so we can have buttons without conditions for manual usgage GGM -->
            </div>

            <div class="row">
                <div class="col s12 m10 offset-m1">
                        <div class="card-content">
                          <ul id="sortableManualBadges" class="collapsible" >
                
                                    {% for i,badgeId,badgeName,badgeImage, badgeDescription, badgePosition in manualBadgesInfo %}
                                    
                                    <li id={{badgeId}}>
                                    <div class="collapsible-header" > <i style="justify-content: center; align-item: center" class="material-icons">swap_vert</i> 
                                        <span style="max-width: 7%;min-width: 7%; left: 0px">
                                            <img src="/{{badgeImage}}" alt="Badge Image" width="50px" height="50px">
                                        </span>
    
                                        <span style="max-width: 30%;min-width: 30%; left: 0px">{{badgeName}}</span>
                                        <span style="max-width: 45%;min-width: 45%; left: 0px"> {{badgeDescription}}</span>
                                        
                                        <span class="right-align" style="max-width: 15%; min-width: 15%;">
                                            <a class="waves-effect waves-light btn" href="/oneUp/badges/EditDeleteBadge?badgeID={{badgeId}}&isManualBadge=true"> Modify</a>
                                        </span>
                                    </li>
                                    {% empty %}
                                    <li>
                                        <div class="center-align">
                                            <i>No badges created</i>
                                        </div>
                                    </li>
                                    {% endfor %}
                                </li>
                            </ul>
                            <script>
										$( function() {
											$( "#sortableManualBadges" ).sortable({

												stop: function(event, ui) {

												var itemOrder = $("#sortableManualBadges").sortable("toArray");

												var idsPositions = []

												for (var i = 0; i < itemOrder.length; i++) {
													if (itemOrder[i]){
														idsPositions.push(String(itemOrder[i])+"---"+String(i));
													}
												}

												var csrftoken = $('input[name="csrfmiddlewaretoken"]').val();

												console.log(idsPositions)

												$.post( "/oneUp/instructors/ReorderBadges", {badgeIdsPositions: idsPositions , csrfmiddlewaretoken: csrftoken,}, function( data ) {
													console.log(data)
												});

												}
												});
											});
										</script>
                        </div>
                    </div>
                </div>

            </div>
        </form>
    </main>
    {% include 'footer.html' %}
</body>

</html>