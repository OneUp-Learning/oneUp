<!DOCTYPE html>
<html lang="en">
<head>
    {% include 'scripts.html' %}
</head>
<body>
    {% include 'heading.html' %}
    <main>
        <div class="row center-align">
            <div class="col s12">
                <h3>Badges</h3>
            </div>
        </div>
        {% csrf_token %}
        <!--  added a title GGM -->
        <div class="row">
            <div class="col s12 m5 offset-m1">
                <h5>Automatic Rule Badges</h5>
            </div>
            <div class="col s12 m5  right-align">
                <a class="waves-effect waves-light btn" href="/oneUp/badges/EditDeleteBadge?isManualBadge=false">
                    <i class="material-icons left">add_circle</i>Add An Automatic Badge</a>
            </div>
        </div>
        <div class="row">
            <div class="col s12 m10 offset-m1">
                <div class="card-panel">
                    {% if badgesInfo|length > 0 %}
                    <ul id="sortable-auto-badges" class="collapsible" >
                        {% for i,badgeId,badgeName,badgeImage, badgeDescription, badgePosition in badgesInfo %}
                        <li id={{badgeId}}>
                            <div class="collapsible-header"><i style="justify-content: center; align-self: center" class="material-icons">swap_vert</i> 
                                <span style="max-width: 7%;min-width: 7%; left: 0px; align-self: center">
                                    <img src="/{{badgeImage}}" alt="Badge Image" width="50px" height="50px">
                                </span>

                                <span style="max-width: 30%;min-width: 30%; left: 0px; align-self: center">{{badgeName}}</span>
                                <span style="max-width: 45%;min-width: 45%; left: 0px; align-self: center"> {{badgeDescription}}</span>
                                
                                <span class="right-align" style="max-width: 15%;min-width: 15%; align-self: center">
                                    <a class="waves-effect waves-light btn" href="/oneUp/badges/EditDeleteBadge?badgeID={{badgeId}}"> Modify</a>
                                </span>
                            </div>
                        </li>
                        {% endfor %}
                        </li>
                    </ul>
                    {% else %}
                    <p>No badges created</p>
                    {% endif %}
                </div>
            </div>
        </div>
        <!-- created a second table to display the badge content GGM-->
        <div class="row">
            <div class="col s12 m5 offset-m1">
                <h5>Manual Badges</h5>
            </div>
            <div class="col s12 m5  right-align">
                <a class="waves-effect waves-light btn" href="/oneUp/badges/EditDeleteBadge?isManualBadge=true">
                    <i class="material-icons left">add_circle</i>Add A Manual Badge</a>
            </div>
        </div>
        <div class="row">
            <div class="col s12 m10 offset-m1">
                <div class="card-panel">
                    {% if manualBadgesInfo|length > 0 %}
                    <ul id="sortable-manual-badges" class="collapsible" >
                        {% for i,badgeId,badgeName,badgeImage, badgeDescription, badgePosition in manualBadgesInfo %}
                        <li id={{badgeId}}>
                            <div class="collapsible-header"><i style="justify-content: center; align-self: center" class="material-icons">swap_vert</i> 
                                <span style="max-width: 7%;min-width: 7%; left: 0px; align-self: center">
                                    <img src="/{{badgeImage}}" alt="Badge Image" width="50px" height="50px">
                                </span>
                                <span style="max-width: 30%;min-width: 30%; left: 0px; align-self: center">{{badgeName}}</span>
                                <span style="max-width: 45%;min-width: 45%; left: 0px; align-self: center"> {{badgeDescription}}</span>
                                <span class="right-align" style="max-width: 15%; min-width: 15%; align-self: center">
                                    <a class="waves-effect waves-light btn" href="/oneUp/badges/EditDeleteBadge?badgeID={{badgeId}}&isManualBadge=true"> Modify</a>
                                </span>
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                    {% else %}
                    <p>No badges created</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </main>
    {% include 'footer.html' %}
</body>
<script>
	$(document).ready(() => {
        $("#sortable-auto-badges").sortable({
			items: "li:not(.not-sortable)",
			update: (event, ui) => {
				var item_list = $("#sortable-auto-badges").sortable("toArray");
				var positions = []

				for (var i = 0; i < item_list.length; i++) {
					if (item_list[i]){
						// console.log("Chall Position: " + i + " ID: " + item_list[i]);
						positions.push({"id": parseInt(item_list[i]), "value": i});
					}
				}

				// console.log(positions)
				const params = {
					method: 'POST',
					headers: {
					'Content-Type': 'application/json',
					'X-CSRFToken': $('input[name="csrfmiddlewaretoken"]').val(),
					},
					body: JSON.stringify({type: 'badge', positions: positions})
				};
				fetch("/oneUp/instructors/reorderList", params)
				.then((response) => { return response.json()})
				.then((response) => {console.log(response)})
			}
		});
		$("#sortable-manual-badges").sortable({
			items: "li:not(.not-sortable)",
			update: (event, ui) => {
				var item_list = $("#sortable-manual-badges").sortable("toArray");
				var positions = []

				for (var i = 0; i < item_list.length; i++) {
					if (item_list[i]){
						// console.log("Chall Position: " + i + " ID: " + item_list[i]);
						positions.push({"id": parseInt(item_list[i]), "value": i});
					}
				}

				// console.log(positions)
				const params = {
					method: 'POST',
					headers: {
					'Content-Type': 'application/json',
					'X-CSRFToken': $('input[name="csrfmiddlewaretoken"]').val(),
					},
					body: JSON.stringify({type: 'badge', positions: positions})
				};
				fetch("/oneUp/instructors/reorderList", params)
				.then((response) => { return response.json()})
				.then((response) => {console.log(response)})
			}
		});
	});
</script>
</html>