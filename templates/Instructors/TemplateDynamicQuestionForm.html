<!DOCTYPE html>
<html lang="en">
  <head>
  
    <meta charset="utf-8" />
    
    {% include 'scripts.html' %}  
    {% load staticfiles %}
    
    
    <script src="/static/ThirdParty/ckeditor_4.6.2_custom1/ckeditor.js"></script>
    <script src="/static/ThirdParty/aceEditor/src-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
    <!--  <script src="/static/ThirdParty/aceEditor/src-noconflict/theme-twilight.js" type="text/javascript" charset="utf-8"></script>
	<script src="/static/ThirdParty/aceEditor/src-noconflict/mode-lua.js" type="text/javascript" charset="utf-8"></script> -->
    
    
    
    <script src="/static/js/AJAXgetquerystring.js" type="text/javascript"></script>
    
    <script type="text/javascript">

    	function testQuestion() {
    		var xmlhttp;
			if (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari
  				xmlhttp=new XMLHttpRequest();
  			} else {// code for IE6, IE5 
  				xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
  			}
  			  			
  			xmlhttp.open("POST","doDynamicQuestion",true);
  			xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
  			xmlhttp.onreadystatechange =
  				function () {
  					if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
  						document.getElementById("codeResults").innerHTML = xmlhttp.responseText;
  					}
  					makeNewEditors();
  				}
  			xmlhttp.send('_test=true&_phase=1&_uniqid=edit&_seed='+encodeURIComponent(document.trial.seed.value)+
  						 '&_numParts='+encodeURIComponent(document.question.numParts.value)+
  				         '&_setupCode='+encodeURIComponent(editor.getValue())+
  				         '&_templateText='+encodeURIComponent(CKEDITOR.instances.templateTextVisible.getData())+
  				         '&csrfmiddlewaretoken={{ csrf_token }}');
    	}
    	
    	function copyContentsToHidden() {
    	    document.question.setupCode.value = editor.getValue();
    	    document.question.templateText.value = CKEDITOR.instances.templateTextVisible.getData();
    	}
    	
    	function disableDiv(name) {
    		var darkLayer = document.getElementById(name+"-darkLayer");
    		darkLayer.style.display="";
    		var element = document.getElementById(name+"-exact");
    		var descendents = element.getElementsByTagName("*");
    		var i, e;
			for (i = 0; i < descendents.length; i++) {
    			e = descendents[i];
    			if ((e.tagName == "INPUT") || (e.tagName == "TEXTAREA") || (e.tagName == "BUTTON") || (e.tagName == "SELECT") ||
    				(e.tagName == "OPTION") || (e.tagName == "OPTGROUP") || (e.tagName == "FIELDSET")) {
    				e.disabled = "disabled";
    			}
    			if ((e.tagName == "INPUT") && (e.type.toUpperCase() == "SUBMIT")) {
    				e.value = "Submitted";
    			}
    			
    		}
    	}
    	
    	
		
    </script> 
    
    <style>
    	#editor {
    		postion: absolute;
    		width: 300;
    		height: 300px;
    	}
    
    </style>
      
  </head>
  <body>
  
  <div>
  
     {% include 'heading.html' %}
  
          <div class="frame" id="grad" align="center">
         	<div class="container">
         	<div class="row">
            <div class="12u">
            	<h1><span>{{challengeName}}</span></h1>
            	<h3>Create/Edit <span>Dynamic Questions</span></h3>
            <p><span class="redstar">*</span> Denotes Required Fields.</p>
  
  
    <form name="question" action="" onsubmit="copyContentsToHidden();return validateForm()" method="POST">
      {% csrf_token %}
      {% if questionId %}
           <input type="hidden" name="questionId" id="questionId" value="{{questionId}}">
      {% endif %}
      {% if challengeID %}
           <input type="hidden" name="challengeID" id="challengeID" value="{{challengeID}}">
      {% endif %}
      <table class="bg">
      	<tr>
      	</tr>
      	<tr>
      		<td>
      			Templated dynamic questions allow instructors to write questions and evaluate answers programmatically using Lua code.
      			Lua code to set up any needed variables and perform any complex math should be included
      			in the SetupCode section.
      			The problem itself should be below.
      			Inside the problem area, if you wish to display a variable, simply enclose it in [| and |].
      			For example, to display the variable x, you would type [|x|].
      			To include Lua code, simply enclose it in [{ and }].
      			One bit of Lua code which you will need to include for any problem is a call to the
      			make_answer function which is used to create answer blanks.
      			Use of this function is required (although it is possible to make answer spaces appear
      			by adding HTML code directly, answer spaces added that way will not function properly in
      			the system).
      			make_answer takes five arguments. The first is the name of the answer blank.
      			This name will be displayed to students when describing their results.
      			The second is the type of the answer blank. The third is the size.
      			The fourth is the answer checking function which will be used.
      			There are several standard answer checking functions provided.
      			The fifth is the maximum number of points which the student can receive for
      			their answer in this blank.
      	</td>
      </tr>
	<tr>
			<td> Preview</td>
	</tr>
	<tr>	
		<td><input type="text" style="border: solid 1px rgba(128, 128, 128, 0.5)" name="preview" value="{{preview}}"></td>
	</tr>
	<tr>
		<td>Difficulty</td>
	</tr>
	<tr>
		<td>
            <div class="select-wrapper">
				<select name="difficulty" style="width: 190px">
					<option value=""selected>Select Difficulty</option>
					<option id="Easy" value="Easy">Easy</option>
					<option id="Medium" value="Medium">Medium</option>
					<option id="Hard" value="Hard">Hard</option>
				</select>
			</div>
            <script  type="text/javascript"> 
                 window.onload = function() {
				document.getElementById("{{difficulty}}").selected = "true";}
			</script> 
		</td>
	</tr>
	<tr>
		 <td>Feedback for Correct Answer</td>
	</tr>
	<tr>
		<td>Instructor Notes</td>
	</tr>
	<tr>
		<td>
			<textarea name="instructorNotes" style="resize:none; border: solid 1px rgba(128, 128, 128, 0.5)" rows="2" cols="70" value="instructorNotes">{{instructorNotes}}</textarea>
		</td>
	</tr>
	<tr>
		<td>Author</td>
	</tr>
	<tr>
		<td><input type="text" style="resize:none; border: solid 1px rgba(128, 128, 128, 0.5)" name="author" value="{{author}}"></td>
	</tr>
	<tr>
		<td>Number of Parts<span class="redstar">*</span></td> <!-- Note this might change its input type -->
	</tr>
	<tr>
		<td><input type="text" style="resize:none; border: solid 1px rgba(128, 128, 128, 0.5)" name="numParts" value="{{numParts}}" required></td>
	</tr>
	<tr>
		<td>Set-Up Code</td>
	</tr>
	<tr>
		<td>
			<div id="editor" style="height: 200px; width: 100%">{{setupCode}}</div>
			<script>
		    		var editor = ace.edit("editor");
				    editor.setTheme("ace/theme/chrome");
				    editor.session.setMode("ace/mode/lua");
			</script>
			<input type="hidden" name="setupCode" style="display: none;" />
		</td>
	</tr>
	<tr>
		<td>Template</td>
	</tr>
	<tr>
		<td>
			<textarea style="resize:none; border: solid 1px rgba(128, 128, 128, 0.5)" rows="10" cols="70" name="templateTextVisible" id="templateTextVisible" >{{templateText}}</textarea>
			<script type="text/javascript" >
                // Replace the <textarea id="templateTextVisible"> with a CKEditor instance, using default configuration.
                CKEDITOR.replace( 'templateTextVisible' );
             </script> 
             <input type="hidden" name="templateText" style="display: none;" />
             
		</td>
	</tr>
 </table>
 	{% if view %}
		<script>
		$(':input').attr('readonly','readonly');
		$(':input').attr('disabled', 'disabled');
		</script>
		<button onclick="goBack()">Back</button>
                     	
		{% elif challenge %}
			<ul class="actions">
			<li style="margin:0"><input type="submit" name="submit" value="Submit" class="button" onclick="prepareSubmit()"></li>
			<a href="/oneUp/instructors/challengeQuestionsList?challengeID={{challengeID}}"><button type="button" class="button special" value="Reset">Cancel</button></a>
		{% else %}	
			<ul class="actions">
			<li><input type="submit" name="submit" value="Submit" class="button" onclick="prepareSubmit()"></li>
			<a href="/oneUp/instructors/questionList"><button type="button" class="button special" value="Reset">Cancel</button></a>
		{% endif %}
			<script>
			function goBack() {
			window.history.back();
			}
			</script>
		</ul>
</form>
<br/>
 
 <!-- <input type="hidden" name="whichform" value="questionedit">      
  <input type="submit" name="submit" value="Submit" class="button">
 <br> -->
  
  <table class="bg">
	<form name="trial" id="trial" action="doDynamicQuestion" method="POST" onSubmit="testQuestion();return false;">
		{% csrf_token %}
	<tr>
		<td>
			<input type="number" name="seed" min="0" max="1000000000" value="0">
			<input type="submit" name="test" value="Try Out Question" class="button">
		</td>
	</tr>
	</form>
	<tr>
		<td><div id="codeResults" align="left" ></div> </td> <!-- Need to see the code for this so we can add border -->
	</tr>
 </table>
   	</div></div></div></div>
 
</div>
    {% include 'footer.html' %}
  </body>
  
</html>
