<!DOCTYPE html>
<html lang="en">
  <head>
  
    <meta charset="utf-8" />
    
    {% include 'scripts.html' %}  
    {% load staticfiles %}
    
    <script src="{% static "AJAXgetquerystring.js" %}" type="text/javascript"></script>
    
    <script type="text/javascript">

    	function testQuestion() {
    		var xmlhttp;
			if (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari
  				xmlhttp=new XMLHttpRequest();
  			} else {// code for IE6, IE5 
  				xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
  			}
  			  			
  			xmlhttp.open("POST","doDynamicQuestion",true);
  			xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
  			xmlhttp.onreadystatechange =
  				function () {
  					if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
  						document.getElementById("codeResults").innerHTML = xmlhttp.responseText;
  					}
  				}
  			xmlhttp.send('_test=true&_phase=1&_uniqid=edit&_seed='+encodeURIComponent(document.trial.seed.value)+
  						 '&_numParts='+encodeURIComponent(document.question.numParts.value)+
  				         '&_code='+encodeURIComponent(document.question.code.value)+'&csrfmiddlewaretoken={{ csrf_token }}');
    	}
    </script> 
      
  </head>
  <body>
  
  <div>
  
     {% include 'heading.html' %}
  
          <div class="frame" id="grad" align="center">
         	<div class="container">
         	<div class="row">
            <div class="12u">
            	<h1><span>{{challengeName}}</span></h1>
            	<h3>Create/Edit <span>Dynamic Questions</span></h3>
            <p><span>*</span> Denotes Required Fields.</p>
  
    <form name="question" action="" onsubmit="return validateForm()" method="POST">
      {% csrf_token %}
      <table class="bg">
      	<tr>
      	</tr>
      	<tr>
      		<td>
      			Dynamic questions allow instructors to write questions and evaluate answers programmatically using Lua code.
      			The code, when run should define the following:
      		<ul>
      			<li> <b> part_1_text </b> A function which takes no input and produces a string which represents the HTML for the first question.
      				If you have more than one part to this problem, you should also define similar functions call part_2_text, part_3_text, etc.
      			<li> <b> evaluate_answer_1 </b> A function which takes in a table which maps the names of the form inputs from part 1 to values which are
      				the answers provided for those form inputs by the user and returns a table which maps the names of the form inputs to 
      				a table containing two values, "success" which maps to a boolean indicating whether or not the answer was sufficient to continue to the next part
      				and "value" which maps to a floating point number indicating how many points were awarded for that answer.  
      			<li> <b> part_1_max_points </b> A function which takes no input and returns a table which maps the name of each input to the maximum possible number
      				of points a student could earn for that question.
  			</ul>	
      	</td>
      </tr>
	<tr>
			<td> Preview</td>
	</tr>
	<tr>	
		<td><input type="text" style="border: solid 1px rgba(128, 128, 128, 0.5)" name="preview" value="{{preview}}"></td>
	</tr>
	<tr>
		<td>Difficulty</td>
	</tr>
	<tr>
		<td>
            <div class="select-wrapper">
				<select name="difficulty" style="width: 190px">
					<option value=""selected>Select Difficulty</option>
					<option id="Easy" value="Easy">Easy</option>
					<option id="Medium" value="Medium">Medium</option>
					<option id="Hard" value="Hard">Hard</option>
				</select>
			</div>
            <script  type="text/javascript"> 
                 window.onload = function() {
				document.getElementById("{{difficulty}}").selected = "true";}
			</script> 
		</td>
	</tr>
	<tr>
		 <td>Feedback for Correct Answer</td>
	</tr>
	<tr>
		<td>  
			<textarea name="correctAnswerFeedback" style="resize:none; border: solid 1px rgba(128, 128, 128, 0.5)" rows="2" cols="70" value="correctAnswerFeedback">{{correctAnswerFeedback}}</textarea>
		</td>
	</tr>
	<tr>
		<td>Feedback for Incorrect Answer</td>
	</tr>
	<tr>
		<td>
			<textarea name="incorrectAnswerFeedback" style="resize:none; border: solid 1px rgba(128, 128, 128, 0.5)" rows="2" cols="70" value="{{incorrectAnswerFeedback}}">{{incorrectAnswerFeedback}}</textarea>
		</td>
	</tr>
	<tr>
		<td>Instructor Notes</td>
	</tr>
	<tr>
		<td>
			<textarea name="instructorNotes" style="resize:none; border: solid 1px rgba(128, 128, 128, 0.5)" rows="2" cols="70" value="instructorNotes">{{instructorNotes}}</textarea>
		</td>
	</tr>
	<tr>
		<td>Author</td>
	</tr>
	<tr>
		<td><input type="text" style="resize:none; border: solid 1px rgba(128, 128, 128, 0.5)" name="author" value="{{author}}"></td>
	</tr>
	<tr>
		<td>Number of Parts<span>*</span></td> <!-- Note this might change its input type -->
	</tr>
	<tr>
		<td><input type="text" style="resize:none; border: solid 1px rgba(128, 128, 128, 0.5)" name="numParts" value="{{numParts}}" required></td>
	</tr>
	<tr>
		<td>Code</td>
	</tr>
	<tr>
		<td>
			<textarea style="resize:none; border: solid 1px rgba(128, 128, 128, 0.5)" rows="20" cols="70" name="code" id="code">{{code}}</textarea>
		</td>
	</tr>
	<tr>
		<td>Template</td>
	</tr>
	<tr>
		<td>
			<textarea style="resize:none; border: solid 1px rgba(128, 128, 128, 0.5)" rows="10" cols="70" name="templateQuestion" id="templateQuestion" >{{templateQuestion}}</textarea>
		</td>
	</tr>
 </table>
 	{% if view %}
		<script>
		$(':input').attr('readonly','readonly');
		$(':input').attr('disabled', 'disabled');
		</script>
		<button onclick="goBack()">Back</button>
                     	
		{% elif challenge %}
			<ul class="actions">
			<li style="margin:0"><input type="submit" name="submit" value="Submit" class="button" onclick="prepareSubmit()"></li>
			<a href="/oneUp/instructors/challengeQuestionsList?challengeID={{challengeID}}"><button type="button" class="button special" value="Reset">Cancel</button></a>
		{% else %}	
			<ul class="actions">
			<li><input type="submit" name="submit" value="Submit" class="button" onclick="prepareSubmit()"></li>
			<a href="/oneUp/instructors/questionList"><button type="button" class="button special" value="Reset">Cancel</button></a>
		{% endif %}
			<script>
			function goBack() {
			window.history.back();
			}
			</script>
		</ul>
</form>
<br/>
 
 <!-- <input type="hidden" name="whichform" value="questionedit">      
  <input type="submit" name="submit" value="Submit" class="button">
 <br> -->
  
  <table class="bg">
	<form name="trial" id="trial" action="doDynamicQuestion" method="POST" onSubmit="testQuestion();return false;">
		{% csrf_token %}
	<tr>
		<td>
			<input type="number" name="seed" min="0" max="1000000000" value="0">
			<input type="submit" name="test" value="Try Out Question" class="button">
		</td>
	</tr>
	</form>
	<tr>
		<td><div id="codeResults" ></div> </td> <!-- Need to see the code for this so we can add border -->
	</tr>
 </table>
 
	</div></div></div></div>
</div>	
    {% include 'footer.html' %}
  </body>
  
</html>
