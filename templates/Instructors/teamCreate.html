<!DOCTYPE html>

<html lang="en">

<head>
    {% include 'scripts.html' %}
    <script>
        function validateAvatar() {
            //console.log(document.getElementsByName('avatar')[0].value);
            var avatars = document.getElementsByName('avatar');
            for (var i = 0; i < avatars.length; i++) {
                if (document.getElementsByName('avatar')[i].checked)
                    return true;
            }
            alert("Please select an avatar.");
            return false;
        }
    </script>
</head>

<body>
    {% include 'heading.html' %}
    <main>
        <div class="row center-align">
            <div class="col s12">
                <h3> Create Teams</h3>
                <p><span class="red-text">*</span> Denotes Required Fields</p>
            </div>
        </div>
        <div class="row">
            <div class="col s12 m10 offset-m1">
                <form name="team" action="/oneUp/instructors/teamCreate" enctype="multipart/form-data" method="POST">
                    {% csrf_token %}
                    <input type="hidden" name="teamID" id="teamID" value="{{teamID}}">
                    <div class="card">
                        <div class="card-content">
                            <div class="row">
                                <div class="input-field col s12">
                                    <i class="material-icons prefix">edit</i>
                                    <input value="{{teamName}}" name="teamName" id="teamName" type="text"
                                        class="validate" pattern=".*\S+.*" required>
                                    <label for="teamName"><span class="red-text">*</span> Team Name</label>
                                </div>
                            </div>


                            <div class="row">
                                <div class="col s12">
                                    <h6> <span class="red-text">*</span>
                                        Team Avatar</h6>
                                    <p> Choose an image to be the team's avatar
                                        <div class="row">
                                            {% if image %}
                                            <img alt="Image" width="76px" height="76px" src="{{image}}">
                                            {% endif %}
                                            <div class="col s12">
                                               <div id="fileupload1" class="file-field input-field">
                                                  <div class="btn">
                                                     <span>File</span>
                                                     <input name="imagefile" type="file">
                                                  </div>
                                                  <div class="file-path-wrapper">
                                                     <input class="file-path validate">
                                                  </div>
                                               </div>
                                            </div>
                                         </div>
                                </div>
                            </div>


                            <script>
                                // Lazy load avatars images
                                // Code from https://developers.google.com/web/fundamentals/performance/lazy-loading-guidance/images-and-video/
                                document.addEventListener("DOMContentLoaded", function () {
                                    var lazyImages = [].slice.call(document.querySelectorAll("img.lazy"));

                                    if ("IntersectionObserver" in window) {
                                        let lazyImageObserver = new IntersectionObserver(function (entries,
                                            observer) {
                                            entries.forEach(function (entry) {
                                                if (entry.isIntersecting) {
                                                    let lazyImage = entry.target;
                                                    lazyImage.src = lazyImage.dataset.src;
                                                    lazyImage.classList.remove("lazy");
                                                    lazyImageObserver.unobserve(lazyImage);
                                                }
                                            });
                                        });

                                        lazyImages.forEach(function (lazyImage) {
                                            lazyImageObserver.observe(lazyImage);
                                        });
                                    } else {
                                        // Possibly fall back to a more compatible method here
                                        let active = false;

                                        const lazyLoad = function () {
                                            if (active === false) {
                                                active = true;

                                                setTimeout(function () {
                                                    lazyImages.forEach(function (lazyImage) {
                                                        if ((lazyImage
                                                                .getBoundingClientRect()
                                                                .top <= window
                                                                .innerHeight && lazyImage
                                                                .getBoundingClientRect()
                                                                .bottom >= 0) &&
                                                            getComputedStyle(lazyImage)
                                                            .display !== "none") {
                                                            lazyImage.src = lazyImage
                                                                .dataset.src;
                                                            lazyImage.classList.remove(
                                                                "lazy");

                                                            lazyImages = lazyImages.filter(
                                                                function (image) {
                                                                    return image !==
                                                                        lazyImage;
                                                                });

                                                            if (lazyImages.length === 0) {
                                                                document
                                                                    .removeEventListener(
                                                                        "scroll", lazyLoad);
                                                                window.removeEventListener(
                                                                    "resize", lazyLoad);
                                                                window.removeEventListener(
                                                                    "orientationchange",
                                                                    lazyLoad);
                                                            }
                                                        }
                                                    });

                                                    active = false;
                                                }, 200);
                                            }
                                        };

                                        document.addEventListener("scroll", lazyLoad);
                                        window.addEventListener("resize", lazyLoad);
                                        window.addEventListener("orientationchange", lazyLoad);
                                    }
                                });
                            </script>
                        </div>
                        <div class="card-action right-align">
                            <button class="btn waves-effect waves-light" type="submit" name="submit">Submit
                                <i class="material-icons right">send</i>
                            </button>
                            <a class="waves-effect waves-light btn" href="/oneUp/instructors/teamList"><i
                                    class="material-icons left">check</i>Done</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </main>
    {% include 'footer.html' %}
</body>

</html>