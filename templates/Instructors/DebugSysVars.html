<!DOCTYPE html>
<html lang="en">

<head>

  {% include 'scripts.html' %}

  <!-- JQuery lib for searching select box -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js"></script>
  <script>
      // Updates the objects section
    function updateObjects () {
      var sysVar = $('#sysVar').find(":selected").val();
      $('#objectSelect').material_select();
      $("#objectSelect").empty().html(' ');
      $('#objectSelect').append('<option disabled selected value> Select an Object Type </option>');
      $('#objectSelect').append('<option value="all" name="objectType">All</option>');

      $.post( "/oneUp/instructors/getObjsForSysVar", {sysVarIndex : sysVar} ,function( data ) {
        var count = 0;
        for (obj in data) {
          objIndex = obj;
          objName = data[obj];
            $('#objectSelect').append('<option value='+obj+'>'+objName+'</option>');
          $("#objectSelect").material_select('update');
        }
    });
    //$( "#debugForm" ).submit();
    };

  </script>
</head>

<body>

  {% include 'heading.html' %}

  <main>
    <div class="row center-align">
      <div class="col s12">
        <h3>System Variables Debug</h3>
      </div>
    </div>
    <div class="row">
      <div class="col s12 m10 offset-m1">

        <form name="debugForm" id="debugForm" enctype="multipart/form-data" action="/oneUp/instructors/debugSysVars"
          method="POST">
          {% csrf_token %}
          <div class="input-field col s4" id="student">
            <select name="student" form="debugForm" id="studentSelect" onchange="this.form.submit()">
              <option value="all" name="student">All</option>
              {% for i,userID,first_Name,last_Name,user_Avatar in user_range %}
              {% if userID == currentStudet %}
              <option value={{userID}} name="student" selected>{{first_Name}} {{last_Name}}</option>
              {% else %}
              <option value={{userID}} name="student">{{first_Name}} {{last_Name}}</option>
              {% endif %}
              {% endfor %}
            </select>
            <label for="studentDebug">Filter by Student Names</label>
          </div>


          <div class="input-field col s4" id="eventSelector">
            <select name="sysVar" form="debugForm" id="sysVar" onchange="updateObjects()">
                <option disabled selected value> Select a System Variable </option>
                {% for i, sysVarNumber, sysVarName in sysVars %}
              {% if sysVarNumber == currenSysVar %}
              <option value={{sysVarNumber}} name="sysVar" selected>{{sysVarName}}</option>
              {% else %}
              <option value={{sysVarNumber}} name="sysVar">{{sysVarName}}</option>
              {% endif %}
              {% endfor %}
            </select>
            <label for="studentDebug">Filter by System Variable</label>
          </div>

          <div class="input-field col s4" id="objectSelector">
            <select name="objectType" form="debugForm" id="objectSelect" onchange="this.form.submit()">
              <option disabled selected value> Select an Object Type </option>
              {% if isAll %}
                <option value="all" name="objectType" selected>All</option>
              {% else %}
                <option value="all" name="objectType">All</option>
              {% endif %}
              {% for i, obj, objName in objects %}
              {% if obj == currentObj %}
              <option value={{obj}} name="objectType" selected>{{objName}}</option>
              {% else %}
              <option value={{obj}} name="objectType">{{objName}}</option>
              {% endif %}
              {% endfor %}
            </select>
            <label for="studentDebug">Filter by Object Type</label>
          </div>
        </form>


        <br />
        <br />
        <br />
        <br />
        <div class="card">
          <div class="card-content">
            <table>
              <thead>
                <th></th>
                <th>Student Name</th>
                <th>Assignment</th> 
                <th>Object Type</th>
                <th>System Variable</th>
                <th>Value</th>
              </thead>
              <tbody>
                {% for data in debugData %}
                <tr>
                  <!--    <td><img class="circle" alt="Avatar Image" width="36" height="36" src="{{user_Avatar}}"></td> -->
                  <td> </td>
                  <td>{{data.0}}</td>
                  <td>{{data.1}}</td>
                  <td>{{data.2}}</td>
                  <td>{{data.3}}</td>
                  <td>{{data.4}}</td>
                </tr>
                {% empty %}
                <tr>
                  <td class="center-align" colspan="8"><i>No students debug data available</i></td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </main>
  {% include 'footer.html' %}
</body>

</html>