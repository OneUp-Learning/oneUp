<!DOCTYPE html>
<html lang="en">
  <head>
  
    <meta charset="utf-8" />
    
    {% include 'scripts.html' %}  
    {% load staticfiles %}
    
    <script src="/static/js/AJAXgetquerystring.js" type="text/javascript"></script>
    <script src="/static/ThirdParty/aceEditor/src-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
    
    
    <script type="text/javascript">

    	function testQuestion() {
    		var xmlhttp;
			if (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari
  				xmlhttp=new XMLHttpRequest();
  			} else {// code for IE6, IE5 
  				xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
  			}
  			  			
  			xmlhttp.open("POST","doDynamicQuestion",true);
  			xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
  			xmlhttp.onreadystatechange =
  				function () {
  					if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
  						document.getElementById("codeResults").innerHTML = xmlhttp.responseText;
  					}
  					makeNewEditors();
  					makeNewReadOnlyEditors()
  				}
  			var formDataEncoded = '_test=true&_phase=1&_uniqid=edit&_seed='+encodeURIComponent(document.trial.seed.value)+
  						 '&_numParts='+encodeURIComponent(document.question.numParts.value)+
  				         '&_code='+encodeURIComponent(editor.getValue())+'&csrfmiddlewaretoken={{ csrf_token }}';
  			formDataEncoded = formDataEncoded + getLibsEncoded()
  			xmlhttp.send(formDataEncoded);
    	}
    	
    	function copyContentsToHidden() {
    	    document.question.code.value = editor.getValue();
    	}
    	
    	function disableDiv(name) {
    		var darkLayer = document.getElementById(name+"-darkLayer");
    		darkLayer.style.display="";
    		var element = document.getElementById(name+"-exact");
    		var descendents = element.getElementsByTagName("*");
    		var i, e;
			for (i = 0; i < descendents.length; i++) {
    			e = descendents[i];
    			if ((e.tagName == "INPUT") || (e.tagName == "TEXTAREA") || (e.tagName == "BUTTON") || (e.tagName == "SELECT") ||
    				(e.tagName == "OPTION") || (e.tagName == "OPTGROUP") || (e.tagName == "FIELDSET")) {
    				e.disabled = "disabled";
    			}
    			if ((e.tagName == "INPUT") && (e.type.toUpperCase() == "SUBMIT")) {
    				e.value = "Submitted";
    			}
    			
    		}
    	}
    		
    </script> 
     
      <style>
    	#editor {
    		postion: absolute;
    		width: 300;
    		height: 300px;
    	}
        .lineHighlight {
  			position:absolute;
  			background:rgba(100,200,100,0.5);
  			z-index:20
		}
      </style>
    
  </head>
  <body>
  
  <div>
  
     {% include 'heading.html' %}
  
          <div class="frame" id="grad" align="center">
         	<div class="container">
         	<div class="row">
            <div class="12u">
            	<h1><span>{{challengeName}}</span></h1>
            	<h3>Create/Edit <span>Dynamic Problems</span></h3>
            <p class = "center"><span>*</span> Denotes Required Fields.</p>
  
    <form name="question" action="" method="POST" onclick="copyContentsToHidden();">
      {% csrf_token %}
      {% if questionId %}
           <input type="hidden" name="questionId" id="questionId" value="{{questionId}}">
      {% endif %}
      {% if challengeID %}
           <input type="hidden" name="challengeID" id="challengeID" value="{{challengeID}}">
      {% endif %}
      <table class="bg">
      	<tr>
      	</tr>
      	<tr>
      		<td>
      			<div id="instructions" hidden>
	      			<p>Dynamic problems allow instructors to write problems and evaluate answers programmatically using Lua code.</p>
	      			<p>The code, when run should define the following:</p>
		      		<ul>
		      			<li> -<b> part_1_text </b> A function which takes no input and produces a string which represents the HTML for the first problem.
		      				If you have more than one part to this problem, you should also define similar functions call part_2_text, part_3_text, etc.
		      			<li> -<b> evaluate_answer_1 </b> A function which takes in a table which maps the names of the form inputs from part 1 to values which are
		      				the answers provided for those form inputs by the user and returns a table which maps the names of the form inputs to 
		      				a table containing two values, "success" which maps to a boolean indicating whether or not the answer was sufficient to continue to the next part
		      				and "value" which maps to a floating point number indicating how many points were awarded for that answer.  
		      			<li> -<b> part_1_max_points </b> A function which takes no input and returns a table which maps the name of each input to the maximum possible number
		      				of points a student could earn for that problem.
		  			</ul>
   				</div>
      			<script>
      				function showDocumentation() {
      					var instDiv = document.getElementById("instructions");
      					var showDiv = document.getElementById("showInstructions");
      					instDiv.removeAttribute("hidden");
      					showDiv.hidden = true;
      				}
      			</script>
      			<div id="showInstructions">
      				<a onclick="showDocumentation();return false;"> Show documentation </a>
      			</div>
      	</td>
      </tr>
	<tr>
			<td> Preview</td>
	</tr>
	<tr>	
		<td><input type="text" style="border: solid 1px rgba(128, 128, 128, 0.5)" name="preview" value="{{preview}}"></td>
	</tr>
	<tr>
		<td>Difficulty</td>
	</tr>
	<tr>
		<td>
            <div class="select-wrapper">
				<select name="difficulty" style="width: 190px">
					<option value=""selected>Select Difficulty</option>
					<option id="Easy" value="Easy">Easy</option>
					<option id="Medium" value="Medium">Medium</option>
					<option id="Hard" value="Hard">Hard</option>
				</select>
			</div>
            <script  type="text/javascript"> 
                 window.onload = function() {
                    try {
                          document.getElementById("{{difficulty}}").selected = "true";
                    } 
                    catch(err) {
                          mess = err;
                    }
                  }
			</script> 
		</td>
	</tr>
	<tr>
		<td>Instructor Notes</td>
	</tr>
	<tr>
		<td>
			<textarea name="instructorNotes" style="resize:none; border: solid 1px rgba(128, 128, 128, 0.5)" rows="2" cols="70" value="instructorNotes">{{instructorNotes}}</textarea>
		</td>
	</tr>
	<tr>
         <td>Author</td>
    </tr>
    <tr>
         <td>
              <textarea name="author" style="resize:none; border: solid 1px rgba(128, 128, 128, 0.5)" rows="2" cols="70">{{author}}</textarea>
         </td>
    </tr>
	
	
	{% if challenge %}
    	{% if unassign %}
       		<tr>
				<td><input type="hidden" name="points" value="0" id="Points"></td>
			</tr>
		{% else %}
      		<tr>
         		<td>Points <span class = "red">*</span></td>
      		</tr>
      		<tr>
         		<td>
            		<input type="hidden" name="challengeID" value="{{challengeID}}">
            		<input style="max-width: 4em;	border: solid 1px rgba(128, 128, 128, 0.5);" type="number" name="points" min="1" max="9999" value="{{points}}" id="Points" required>
   				</td>
			</tr>
   		{% endif %}
		<tr>
		<td></td>
		</tr>
 		<tr>
   			<td>
      			{% include "Instructors/ProblemSkillEmbed.html" %}
   			</td>
		</tr>
	{% endif %}
	<tr>
		<td>Tags</td>
	</tr>
	<tr>
   		<td>
      		<input style="border: solid 1px rgba(128, 128, 128, 0.5);" type="text" name="tags" value="{{tags}}">
			<font style="font-size:.8em;">Enter tags separated by commas (,)</font>
   		</td>
	</tr>
	
	{% include "Instructors/luaLibraryDependencies.html" %}
	<tr>
		<td>Number of Parts<span>*</span></td> <!-- Note this might change its input type -->
	</tr>
	<tr>
		<td><input type="text" style="resize:none; border: solid 1px rgba(128, 128, 128, 0.5)" name="numParts" value="{{numParts}}" required></td>
	</tr>
	<tr>
		<td>Code</td>
	</tr>
	<tr>
		<td>
			<div id="editor"><textarea style="resize:none; border: solid 1px rgba(128, 128, 128, 0.5)" rows="20" cols="70" name="code" id="code">{{code}}</textarea></div>
			<script>
				var editor = ace.edit("editor");
		    	editor.setTheme("ace/theme/chrome");
		    	editor.session.setMode("ace/mode/lua");
			</script>
			<input type="hidden" name="code" style="display: none;" />
		</td>
	</tr>
 </table>
                     	
		{% if challenge %}
			<ul class="actions">
			<li style="margin:0"><input type="submit" name="submit" value="Submit" class="button"></li>
			<a href="/oneUp/instructors/challengeQuestionsList?challengeID={{challengeID}}"><button type="button" class="button special" value="Reset">Cancel</button></a>
		{% else %}	
			<ul class="actions">
			<li><input type="submit" name="submit" value="Submit" class="button"></li>
			<a href="/oneUp/instructors/questionList"><button type="button" class="button special" value="Reset">Cancel</button></a>
		{% endif %}
			<script>
			function goBack() {
			window.history.back();
			}
			</script>
		</ul>
</form>
<br/>
 
 <!-- <input type="hidden" name="whichform" value="questionedit">      
  <input type="submit" name="submit" value="Submit" class="button">
 <br> -->
  
  <table class="bg">
	<form name="trial" id="trial" action="doDynamicQuestion" method="POST" onSubmit="testQuestion();return false;">
		{% csrf_token %}
	<tr>
		<td>
			<input type="submit" name="test" value="Try Out Question" class="button"> &nbsp;
			Random Seed: <input type="number" name="seed" min="0" max="1000000000" value="0">
		</td>
	</tr>
	</form>
	<tr>
		<td><div id="codeResults" ></div> </td> <!-- Need to see the code for this so we can add border -->
	</tr>
 </table>
 
	</div></div></div></div>
</div>	
    {% include 'footer.html' %}
  </body>
  
</html>
