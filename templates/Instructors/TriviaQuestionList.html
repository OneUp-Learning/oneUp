<!DOCTYPE html>
<html lang="en">

<head>
	{% include 'scripts.html' %}
	<style>
		.btn-block{
		width: 100%;
		}
		.right-button{
		position: 	absolute;
		top: 		82%;
		right: 		3%;}
	</style>
</head>

<body>
	{% include 'heading.html' %}
	<main>
		<div class="row center-align">
			<div class="col s12 m10 offset-m1">
				
				<h3>Trivia Questions</h3>
				
			</div>
		</div>
		<div class="row right-align">
			<div class="col s12 m10 offset-m1">
				
				<button class="btn waves-effect waves-light" onclick="ToggleAllCheckboxes(this)" type="button"><i class="material-icons left">select_all</i>Select All</button>
				<a class="modal-trigger waves-effect waves-light btn" href="#modal-create-import"><i
						class="material-icons left">cloud_download</i>Import Problem</a>
				<div id="modal-create-import" class="modal modal-fixed-footer">
					<div class="modal-content">
						<div class="row center-align">
							<div class="col s12 m10 offset-m1">
								<h4>Select a problem to import.</h4>
							</div>
						</div>
						<div class="row">
							<div class="input-field col s12 m10 offset-m1">		
							</div>
						</div>
					</div>
					<div class="modal-footer">
						<a href="#!"
							class="modal-action modal-close waves-effect waves-light btn-flat secondary-colored-text">Cancel</a>
						<a href="#!" class="modal-action modal-close waves-effect waves-light btn" id="create">Create Problem</a>
					</div>
				</div>
				<a class="modal-trigger waves-effect waves-light btn" href="#modal-create-new"><i
						class="material-icons left">add_circle</i>Add a Question</a>
				<div id="modal-create-new" class="modal modal-fixed-footer">
					<div class="modal-content">
						<div class="row center-align">
							<div class="col s12 m10 offset-m1">
								<h4>Select Question Type</h4>
							</div>
						</div>
						<div class="row">
							<div class="input-field col s12 m10 offset-m1">								
								<select id="create-type">
									<option value="" disabled selected>Select Question Type</option>
									<option value="/oneUp/instructors/TriviaTrueFalseForm">True/False</option>
									<option value="/oneUp/instructors/TriviaMultipleAnswerForm">Multiple Choice</option>
								</select>
								<label>Question Type</label>
							</div>
						</div>
					</div>
					<div class="modal-footer">
						<a href="#!"
							class="modal-action modal-close waves-effect waves-light btn-flat secondary-colored-text">Cancel</a>
						<a href="#!" class="modal-action modal-close waves-effect waves-light btn" id="create">Create Problem</a>
					</div>

				</div>
				
			</div>
		</div>
		<div class="row">
			<div class="col s12 m10 offset-m1">
				<div class="card-panel">
					
					<ul id="sortable-questions" class="collapsible">
					</ul>
					
					<div class="card-action right-align">
						
						<a id="submit3" class="waves-effect waves-light btn modal-trigger" href="#modal_confirm1">
							<i class="material-icons right">send</i>Delete all checked</a>
						<div id="modal_confirm1" class="modal">
							<div class="modal-content left-align">
								<h5>Are you sure you want to submit?</h5>
								<p>Warning, this will delete the selected problems. Please confirm.</p>
							</div>
							<div class="modal-footer">
								<a href="#!"
									class="modal-action modal-close waves-effect waves-light btn-flat secondary-colored-text">Cancel</a>
								<button class="modal-action modal-close waves-effect waves-light btn-flat" type="submit"
									id="submit4" onclick="return deleteTriviaProblemsButFilter();" value="Submit">Submit
								</button>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</main>
</body>

<script>
	$(document).ready(() => {
		$('#create').on('click', function () {
            var val = $('#create-type').find(':selected').val();
            if (val) {
            	top.location.href = val;
            }
        });
		$("#sortable-questions").sortable({
			items: "li:not(.not-sortable)",
			update: (event, ui) => {
				var item_list = $("#sortable-questions").sortable("toArray");
				var positions = []

				for (var i = 0; i < item_list.length; i++) {
					if (item_list[i]){
						// console.log("Chall Position: " + i + " ID: " + item_list[i]);
						positions.push({"id": parseInt(item_list[i]), "value": i});
					}
				}

				// console.log(positions)
				const params = {
					method: 'POST',
					headers: {
					'Content-Type': 'application/json',
					'X-CSRFToken': $('input[name="csrfmiddlewaretoken"]').val(),
					},
					body: JSON.stringify({type: 'question', positions: positions})
				};
				fetch("/oneUp/instructors/reorderList", params)
				.then((response) => { return response.json()})
				.then((response) => {console.log(response)})
			}
		});
	});
</script>
<script>
	var checked = false;
	var checkBoxes = document.getElementsByName('deletion-checkboxes');

	function ToggleAllCheckboxes(event) {
		checked = !checked;
		if (checked)
			event.childNodes[0].textContent = "Deselect All"
		else
			event.childNodes[0].textContent = "Select All"

		for (var i = 0; i < checkBoxes.length; i++) {
			checkBoxes[i].checked = checked;
		}
	}
	function deleteQuestion(questionID, challengeID) {
		var xhttp = new XMLHttpRequest();
		
		xhttp.open("POST", "/oneUp/instructors/deleteQuestion", true);
		xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
		xhttp.send("questionId=" + questionID + "&csrfmiddlewaretoken=53b4hclfCsoec5OJaviuRw1zyJ64Zd7gxN5T6qFCr7KZnY5OljtJ1FA53tj4Pijo");
		
		xhttp.onload = function () {
			location.reload();
		}
	}
	function collectAllSelectedCheckboxes() {
		var selectedList = [];
		var checkboxes = document.getElementsByName('deletion-checkboxes');
		for (var i = 0; i < checkboxes.length; i++) {
			if (checkboxes[i].checked) {
				selectedList.push(checkboxes[i].value)
			}
		}
		return selectedList;
	}
	function deleteProblemsButFilter() {
		var selectedChallenges = collectAllSelectedCheckboxes();
		if (selectedChallenges.length > 0) {
			var xhttp = new XMLHttpRequest();
			xhttp.open("POST", "/oneUp/instructors/deleteProblemsButFilterTakenByStudent", true);
			xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
			xhttp.send("deletion_checkboxes=" + selectedChallenges + "&csrfmiddlewaretoken=53b4hclfCsoec5OJaviuRw1zyJ64Zd7gxN5T6qFCr7KZnY5OljtJ1FA53tj4Pijo");
			console.table(xhttp.responseText);
			Materialize.toast(xhttp.responseText.errorMessages, 4000);
			// for (var i = 0; i < xhttp.responseText.errorMessages.length; i++) {
			//    Materialize.toast(xhttp.responseText.errorMessages[i], 4000);
			// }

			xhttp.onload = function () {location.reload();}
		}
  	}
</script>
</html>
