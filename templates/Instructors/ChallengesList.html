<!DOCTYPE html>
<html lang="en">

<head>
	{% include 'scripts.html' %}
</head>

<body>
	{% include 'heading.html' %}
	<main>
		<div class="row center-align">
			<div class="col s12">
				<h3>Serious Challenges</h3>
			</div>
		</div>
		<form name="challengeOrder" action="/oneUp/instructors/reorderChallenges" method="POST">
			{% csrf_token %}
			<input type="hidden" name="courseID" value="{{courseID}}" id="courseID">
			<input type="hidden" name="challengeType" value="Serious" id="challengeType{{courseID}}">
			<div class="row right-align">
				<div class="col s12 m10 offset-m1">
					<a class="waves-effect waves-light btn" href="/oneUp/instructors/challengeCreate"><i class="material-icons left">add_circle</i>Add
						New Challenge</a>
					<button class="btn waves-effect waves-light" type="submit" name="submit">Reorder Challenges
						<i class="material-icons right">reorder</i>
					</button>
				</div>
			</div>
			<div class="row">
				<div class="col s12 m10 offset-m1">
					<div class="card-panel">
						<table>
							<thead>
								<tr>
									<th>Name</th>
									<th>Status</th>
									<th>Display From</th>
									<th>Display Until</th>
									<th>Position</th>
								</tr>
							</thead>
							<tbody>
								{% for i,chall_ID,chall_Name, chall_visible,start_Timestamp,end_Timestamp, chall_position in challenge_range %}
								<input type="hidden" name="challengeID" value="{{chall_ID}}">
								<tr>
									<td>{{chall_Name}}</td>
									<td>{{chall_visible}}</td>
									<td>{{start_Timestamp}}</td>
									<td>{{end_Timestamp}}</td>
									<td>
										<div class="input-field col s12">
											<input placeholder="Position" value="{{chall_position}}" name="{{chall_ID}}" id="chall_position" maxlength="4"
											 type="number" class="validate" min="0" required>
										</div>
									</td>
									<td>
										<a class="dropdown-button tooltipped secondary-content" href="#!" data-constrainwidth="false"
										 data-beloworigin="true" data-activates='dropdown{{i}}' data-position="right" data-delay="50" data-tooltip="Options"><i
											 class="material-icons">more_vert</i></a>
										<ul id='dropdown{{i}}' class='dropdown-content'>
											<li><a href="/oneUp/instructors/challengeCreate?challengeID={{chall_ID}}&view">View</a></li>
											<li><a href="/oneUp/instructors/challengeCreate?challengeID={{chall_ID}}">Edit</a></li>
											<li><a href="/oneUp/instructors/challengeQuestionsList?challengeID={{chall_ID}}">Problems</a></li>
											<li><a href="/oneUp/instructors/adjustmentList?challengeID={{chall_ID}}">Adjustment</a></li>
											<li class="divider"></li>
											<li><a class="modal-trigger" href="#modal_delete{{i}}">Delete</a></li>
										</ul>
										<div id="modal_delete{{i}}" class="modal">
											<div class="modal-content">
												<h5>Are you sure you want to delete?</h5>
												<p>Problems will not be deleted</p>
											</div>
											<div class="modal-footer">
												<a href="#!" class="modal-action modal-close waves-effect waves-light btn-flat" style="color: #00bcd4">Cancel</a>
												<button type="button" class="modal-action modal-close waves-effect waves-light btn-flat" value="Delete" onclick="deleteChallenge('{{chall_ID}}')">Delete
												</button>
											</div>
										</div>
									</td>
								</tr>
								{% empty %}
								<tr>
									<td class="center-align" colspan="5"><i>No serious challenge created</i></td>
								</tr>
								{% endfor %}
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</form>
	</main>
	{% include 'footer.html' %}
</body>
<script>
	function deleteChallenge(challenge_id) {
		function getCookie(name) {
			var cookieValue = null;
			if (document.cookie && document.cookie !== '') {
				var cookies = document.cookie.split(';');
				for (var i = 0; i < cookies.length; i++) {
					var cookie = jQuery.trim(cookies[i]);
					// Does this cookie string begin with the name we want?
					if (cookie.substring(0, name.length + 1) === (name + '=')) {
						cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
						break;
					}
				}
			}
			return cookieValue;
		}

		function csrfSafeMethod(method) {
			// these HTTP methods do not require CSRF protection
			return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
		}

		var csrftoken = getCookie('csrftoken');
		$.ajaxSetup({
			beforeSend: function (xhr, settings) {
				if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
					xhr.setRequestHeader("X-CSRFToken", csrftoken);
				}
			}
		});
		$.ajax({
			type: "POST",
			url: "/oneUp/instructors/deleteChallenge",
			data: {
				'challengeID': challenge_id // from form
			},
			success: function () {
				console.log("Deleted");
				location.reload();
			}
		});
	}
</script>

</html>